<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é˜²æŠ¤æ–¹æ¡ˆ - ä¸­é—´äººæ”»å‡»</title>
  <link rel="stylesheet" href="../xss/style.css">
  <style>
    .compare-box { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 15px 0; }
    @media (max-width: 768px) { .compare-box { grid-template-columns: 1fr; } }
    .unsafe-box { border: 2px solid #f44336; padding: 15px; border-radius: 8px; background: #ffebee; }
    .safe-box { border: 2px solid #4caf50; padding: 15px; border-radius: 8px; background: #e8f5e9; }
    .packet-box { background: #263238; color: #aed581; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 12px; margin: 10px 0; }
  </style>
</head>
<body>
  <div class="container">
    <a href="index.html" class="back-link">â† è¿”å›ä¸­é—´äººæ”»å‡»</a>
    <h1>ğŸ›¡ï¸ å®éªŒä¸‰ï¼šé˜²æŠ¤æ–¹æ¡ˆ</h1>

    <div class="info-box">
      <strong>æ ¸å¿ƒé˜²æŠ¤æ€è·¯</strong>
      <p>åŠ å¯†ä¼ è¾“ + å®Œæ•´æ€§æ ¡éªŒ + èº«ä»½éªŒè¯</p>
    </div>

    <section>
      <h2>ğŸ” HTTPS åŠ å¯†</h2>
      <div class="compare-box">
        <div class="unsafe-box">
          <h3>âŒ HTTP æ˜æ–‡</h3>
          <div class="packet-box" style="background: #1a1a2e; color: #f44336;">
POST /login HTTP/1.1

{"username":"alice","password":"secret123"}

âš ï¸ æ”»å‡»è€…å¯ç›´æ¥è¯»å–
          </div>
        </div>
        <div class="safe-box">
          <h3>âœ… HTTPS åŠ å¯†</h3>
          <div class="packet-box">
TLS 1.3 Application Data

17 03 03 00 45 8a 2f 9c 3b e7 ...

ğŸ”’ åŠ å¯†æ•°æ®ï¼Œæ— æ³•è§£è¯»
          </div>
        </div>
      </div>
    </section>

    <section>
      <h2>âœï¸ æ•°å­—ç­¾å</h2>
      <div class="info-box">
        <p>å¯¹è¯·æ±‚æ•°æ®ç­¾åï¼ŒæœåŠ¡å™¨éªŒè¯ç­¾åï¼Œç¯¡æ”¹åç­¾åå¤±æ•ˆ</p>
        <pre><code>// å®¢æˆ·ç«¯ç­¾å
const data = { from: 'alice', to: 'bob', amount: 1000 }
const signature = HMAC(JSON.stringify(data), secretKey)

// æœåŠ¡ç«¯éªŒè¯
const expectedSig = HMAC(JSON.stringify(req.body), secretKey)
if (signature !== expectedSig) {
  throw new Error('ç­¾åéªŒè¯å¤±è´¥ï¼Œæ•°æ®å¯èƒ½è¢«ç¯¡æ”¹')
}</code></pre>
      </div>
      
      <h3>æ¼”ç¤º</h3>
      <button onclick="transferWithSignature()" class="btn" style="background: #4caf50;">å¸¦ç­¾åè½¬è´¦</button>
      <button onclick="transferTampered()" class="btn" style="background: #f44336;">ç¯¡æ”¹åè½¬è´¦</button>
      <div id="sig-result" class="info-box" style="margin-top: 10px;">ç‚¹å‡»æŒ‰é’®æµ‹è¯•...</div>
    </section>

    <section>
      <h2>ğŸ“œ HSTS (HTTP Strict Transport Security)</h2>
      <div class="info-box">
        <p>å¼ºåˆ¶æµè§ˆå™¨ä½¿ç”¨ HTTPSï¼Œé˜²æ­¢ SSL å‰¥ç¦»æ”»å‡»</p>
        <pre><code>// å“åº”å¤´
Strict-Transport-Security: max-age=31536000; includeSubDomains

// æ•ˆæœ
1. æµè§ˆå™¨è‡ªåŠ¨å°† HTTP è¯·æ±‚å‡çº§ä¸º HTTPS
2. è¯ä¹¦é”™è¯¯æ—¶æ‹’ç»è¿æ¥ï¼ˆæ— æ³•ç‚¹å‡»ç»§ç»­ï¼‰
3. é¢„åŠ è½½åˆ—è¡¨å¯é˜²æ­¢é¦–æ¬¡è®¿é—®è¢«æ”»å‡»</code></pre>
      </div>
    </section>

    <section>
      <h2>ğŸ“Œ è¯ä¹¦å›ºå®š (Certificate Pinning)</h2>
      <div class="info-box">
        <p>å®¢æˆ·ç«¯é¢„ç½®æœåŠ¡å™¨è¯ä¹¦æŒ‡çº¹ï¼Œé˜²æ­¢ä¼ªé€ è¯ä¹¦</p>
        <pre><code>// ç§»åŠ¨ç«¯å®ç°
const expectedFingerprint = 'sha256/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA='

func validateCertificate(cert) {
  const fingerprint = sha256(cert.publicKey)
  if (fingerprint !== expectedFingerprint) {
    throw new Error('è¯ä¹¦ä¸åŒ¹é…ï¼Œå¯èƒ½å­˜åœ¨ä¸­é—´äººæ”»å‡»')
  }
}</code></pre>
      </div>
    </section>

    <section>
      <h2>ğŸ“‹ é˜²æŠ¤æ£€æŸ¥æ¸…å•</h2>
      <table class="info-table">
        <tr><th>æªæ–½</th><th>é˜²æŠ¤ç›®æ ‡</th><th>å®ç°æ–¹å¼</th></tr>
        <tr><td>HTTPS</td><td>æ•°æ®åŠ å¯†</td><td>TLS è¯ä¹¦</td></tr>
        <tr><td>HSTS</td><td>é˜² SSL å‰¥ç¦»</td><td>å“åº”å¤´</td></tr>
        <tr><td>è¯ä¹¦å›ºå®š</td><td>é˜²ä¼ªé€ è¯ä¹¦</td><td>å®¢æˆ·ç«¯æ ¡éªŒ</td></tr>
        <tr><td>æ•°å­—ç­¾å</td><td>æ•°æ®å®Œæ•´æ€§</td><td>HMAC/RSA</td></tr>
        <tr><td>åŒå‘è®¤è¯</td><td>èº«ä»½éªŒè¯</td><td>å®¢æˆ·ç«¯è¯ä¹¦</td></tr>
      </table>
    </section>
  </div>

  <script>
    async function transferWithSignature() {
      const data = { from: 'alice', to: 'bob', amount: 100 }
      // æ¨¡æ‹Ÿæ­£ç¡®ç­¾å
      const signature = btoa(`${data.from}:${data.to}:${data.amount}:secret`)
      
      const res = await fetch('/api/mitm/safe/transfer', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ ...data, signature })
      })
      const result = await res.json()
      
      document.getElementById('sig-result').innerHTML = `
        <span style="color: #4caf50">âœ… ${result.message}</span>
        <br>ç­¾åéªŒè¯é€šè¿‡ï¼Œè½¬è´¦æˆåŠŸ
      `
    }
    
    async function transferTampered() {
      // æ¨¡æ‹Ÿç¯¡æ”¹ï¼šç­¾åæ˜¯ bobï¼Œä½†æ•°æ®æ”¹æˆ attacker
      const signature = btoa('alice:bob:100:secret')
      
      const res = await fetch('/api/mitm/safe/transfer', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          from: 'alice', 
          to: 'attacker',  // ç¯¡æ”¹æ”¶æ¬¾äºº
          amount: 100, 
          signature 
        })
      })
      const result = await res.json()
      
      document.getElementById('sig-result').innerHTML = `
        <span style="color: #f44336">âŒ ${result.error}</span>
        <br>æ•°æ®è¢«ç¯¡æ”¹ï¼Œç­¾åä¸åŒ¹é…ï¼Œè¯·æ±‚è¢«æ‹’ç»
      `
    }
  </script>
</body>
</html>
