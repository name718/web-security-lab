<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æµé‡å—…æ¢ - ä¸­é—´äººæ”»å‡»</title>
  <link rel="stylesheet" href="../xss/style.css">
  <style>
    .network-diagram { display: flex; justify-content: space-around; align-items: center; padding: 20px; background: #16213e; border-radius: 8px; margin: 15px 0; }
    .node { text-align: center; padding: 15px; background: #0f3460; border-radius: 8px; color: #eee; }
    .node.attacker { background: #3d1f1f; border: 2px solid #f44336; }
    .arrow { font-size: 24px; color: #888; }
    .packet-box { background: #1a1a2e; color: #0f0; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 12px; margin: 10px 0; max-height: 200px; overflow: auto; }
    .intercepted { background: #3d1f1f; border: 2px solid #f44336; padding: 15px; border-radius: 8px; margin: 10px 0; color: #ff6b6b; }
  </style>
</head>
<body>
  <div class="container">
    <a href="index.html" class="back-link">â† è¿”å›ä¸­é—´äººæ”»å‡»</a>
    <h1>ğŸ‘ï¸ å®éªŒä¸€ï¼šæµé‡å—…æ¢</h1>

    <div class="warning-box">
      <strong>âš ï¸ æ”»å‡»åœºæ™¯</strong>
      <p>HTTP æ˜æ–‡ä¼ è¾“æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥æˆªè·æ‰€æœ‰æ•°æ®ï¼ŒåŒ…æ‹¬å¯†ç </p>
    </div>

    <section>
      <h2>ğŸŒ ç½‘ç»œæ‹“æ‰‘</h2>
      <div class="network-diagram">
        <div class="node">
          <div style="font-size: 32px;">ğŸ‘¤</div>
          <div>ç”¨æˆ·</div>
        </div>
        <div class="arrow">â”€â”€ğŸ“¡â”€â”€</div>
        <div class="node attacker">
          <div style="font-size: 32px;">ğŸ•µï¸</div>
          <div>æ”»å‡»è€…</div>
          <small>(å—…æ¢æµé‡)</small>
        </div>
        <div class="arrow">â”€â”€ğŸ“¡â”€â”€</div>
        <div class="node">
          <div style="font-size: 32px;">ğŸ–¥ï¸</div>
          <div>æœåŠ¡å™¨</div>
        </div>
      </div>
    </section>

    <section>
      <h2>ğŸ® æ”»å‡»æ¼”ç¤º</h2>
      
      <div class="info-box">
        <h3>ç”¨æˆ·ç™»å½•ï¼ˆHTTP æ˜æ–‡ï¼‰</h3>
        <div>
          <input type="text" id="username" value="alice" placeholder="ç”¨æˆ·å" style="padding: 8px; margin: 5px;">
          <input type="password" id="password" value="alice123" placeholder="å¯†ç " style="padding: 8px; margin: 5px;">
          <button onclick="loginUnsafe()" class="btn">ç™»å½• (HTTP)</button>
        </div>
        <div id="login-result" style="margin-top: 10px;"></div>
      </div>

      <div class="intercepted">
        <h3>ğŸ”´ æ”»å‡»è€…æˆªè·çš„æ•°æ®</h3>
        <div class="packet-box" id="intercepted-data">
ç­‰å¾…æˆªè·æ•°æ®...
        </div>
      </div>
    </section>

    <section>
      <h2>ğŸ“¦ HTTP æ•°æ®åŒ…åˆ†æ</h2>
      <div class="packet-box">
POST /api/login HTTP/1.1
Host: bank.com
Content-Type: application/json

{
  "username": "alice",
  "password": "alice123"  â† <span style="color: #f44336;">æ˜æ–‡å¯†ç ï¼</span>
}
      </div>
    </section>

    <section>
      <h2>ğŸ›¡ï¸ å¯¹æ¯”ï¼šHTTPS åŠ å¯†</h2>
      <div class="info-box">
        <button onclick="loginSafe()" class="btn" style="background: #4caf50;">ç™»å½• (HTTPS)</button>
        <div id="safe-result" style="margin-top: 10px;"></div>
      </div>
      <div class="packet-box" style="background: #1b5e20;">
TLS 1.3 Encrypted Application Data
17 03 03 00 45 8a 2f 9c 3b ... <span style="color: #81c784;">â† åŠ å¯†æ•°æ®ï¼Œæ— æ³•è¯»å–</span>
      </div>
    </section>

    <section>
      <h2>ğŸ’€ çœŸå®æ”»å‡»å·¥å…·</h2>
      <table class="info-table">
        <tr><th>å·¥å…·</th><th>åŠŸèƒ½</th></tr>
        <tr><td>Wireshark</td><td>ç½‘ç»œåè®®åˆ†æå™¨</td></tr>
        <tr><td>tcpdump</td><td>å‘½ä»¤è¡ŒæŠ“åŒ…å·¥å…·</td></tr>
        <tr><td>Ettercap</td><td>ä¸­é—´äººæ”»å‡»æ¡†æ¶</td></tr>
        <tr><td>mitmproxy</td><td>HTTP/HTTPS ä»£ç†</td></tr>
      </table>
    </section>
  </div>

  <script>
    async function loginUnsafe() {
      const username = document.getElementById('username').value
      const password = document.getElementById('password').value
      
      const res = await fetch('/api/mitm/unsafe/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      })
      const data = await res.json()
      document.getElementById('login-result').innerHTML = 
        `<span style="color: ${data.success ? '#4caf50' : '#f44336'}">${data.success ? 'âœ…' : 'âŒ'} ${data.message || data.error}</span>`
      
      // æ˜¾ç¤ºæˆªè·çš„æ•°æ®
      const intercepted = await fetch('/api/mitm/intercepted')
      const list = await intercepted.json()
      const latest = list[list.length - 1]
      if (latest) {
        document.getElementById('intercepted-data').innerHTML = `
[${latest.timestamp}] æˆªè· ${latest.type} è¯·æ±‚
åè®®: ${latest.protocol} (æœªåŠ å¯†)
æ•°æ®: ${JSON.stringify(latest.data, null, 2)}

âš ï¸ ${latest.warning}
        `
      }
    }
    
    async function loginSafe() {
      const username = document.getElementById('username').value
      const password = document.getElementById('password').value
      
      const res = await fetch('/api/mitm/safe/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password })
      })
      const data = await res.json()
      document.getElementById('safe-result').innerHTML = 
        `<span style="color: #4caf50">ğŸ”’ ${data.message} - æ•°æ®å·²åŠ å¯†ï¼Œæ”»å‡»è€…æ— æ³•è¯»å–</span>`
    }
  </script>
</body>
</html>
