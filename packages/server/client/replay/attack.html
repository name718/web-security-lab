<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Token é‡æ”¾æ”»å‡»æ¼”ç¤º - Security Lab</title>
  <link rel="stylesheet" href="../xss/style.css">
  <style>
    .device-box { border: 2px solid #ddd; border-radius: 8px; padding: 15px; margin: 10px 0; }
    .device-a { border-color: #4caf50; background: #f1f8e9; }
    .device-b { border-color: #f44336; background: #ffebee; }
    .device-label { display: inline-block; padding: 4px 12px; border-radius: 4px; font-weight: bold; margin-bottom: 10px; }
    .device-a .device-label { background: #4caf50; color: white; }
    .device-b .device-label { background: #f44336; color: white; }
    .token-display { background: #263238; color: #aed581; padding: 10px; border-radius: 4px; font-family: monospace; word-break: break-all; margin: 10px 0; }
    .result-box { background: #f5f5f5; padding: 10px; border-radius: 4px; margin-top: 10px; min-height: 60px; }
  </style>
</head>
<body>
  <div class="container">
    <a href="index.html" class="back-link">â† è¿”å› Token é‡æ”¾æ”»å‡»</a>
    <h1>ğŸ¯ å®éªŒä¸€ï¼šToken é‡æ”¾æ”»å‡»</h1>

    <div class="warning-box">
      <strong>âš ï¸ æ”»å‡»åœºæ™¯</strong>
      <p>æ”»å‡»è€…è·å–ç”¨æˆ· Token åï¼Œåœ¨è‡ªå·±çš„è®¾å¤‡ä¸Šä½¿ç”¨ï¼Œå†’å……ç”¨æˆ·èº«ä»½</p>
    </div>

    <section>
      <h2>ğŸ® æ”»å‡»æ¼”ç¤º</h2>
      
      <div class="device-box device-a">
        <span class="device-label">ğŸ“± è®¾å¤‡ A (å—å®³è€…)</span>
        <p>ç”¨æˆ· alice åœ¨è‡ªå·±çš„è®¾å¤‡ç™»å½•</p>
        <button onclick="loginDeviceA()" class="btn">ç™»å½• (alice / alice123)</button>
        <div class="token-display" id="token-a">Token: æœªç™»å½•</div>
        <button onclick="copyToken()" class="btn btn-secondary">ğŸ“‹ å¤åˆ¶ Token</button>
        <button onclick="checkProfileA()" class="btn btn-secondary">æŸ¥çœ‹èµ„æ–™</button>
        <div class="result-box" id="result-a">ç™»å½•åæŸ¥çœ‹ç»“æœ...</div>
      </div>

      <div style="text-align: center; padding: 20px;">
        <span style="font-size: 24px;">â¬‡ï¸ æ”»å‡»è€…çªƒå– Token â¬‡ï¸</span>
      </div>

      <div class="device-box device-b">
        <span class="device-label">ğŸ’» è®¾å¤‡ B (æ”»å‡»è€…)</span>
        <p>æ”»å‡»è€…ä½¿ç”¨çªƒå–çš„ Token</p>
        <input type="text" id="stolen-token" placeholder="ç²˜è´´çªƒå–çš„ Token" style="width: 100%; padding: 8px; margin: 10px 0;">
        <button onclick="useStolen()" class="btn">ä½¿ç”¨çªƒå–çš„ Token</button>
        <button onclick="transferStolen()" class="btn" style="background: #f44336;">è½¬è´¦ Â¥1000</button>
        <div class="result-box" id="result-b">ç²˜è´´ Token åæ“ä½œ...</div>
      </div>
    </section>

    <section>
      <h2>ğŸ’€ æ”»å‡»æˆåŠŸåŸå› </h2>
      <div class="info-box">
        <ul>
          <li>æœåŠ¡å™¨åªéªŒè¯ Token æ˜¯å¦æœ‰æ•ˆ</li>
          <li>ä¸æ£€æŸ¥ Token æ¥æºè®¾å¤‡</li>
          <li>ä¸æ£€æŸ¥ IP åœ°å€å˜åŒ–</li>
          <li>Token é•¿æœŸæœ‰æ•ˆï¼Œæ— è¿‡æœŸæœºåˆ¶</li>
        </ul>
      </div>
    </section>

    <section>
      <h2>ğŸ“Š è´¦æˆ·çŠ¶æ€</h2>
      <div id="account-status" class="info-box">
        <p>alice ä½™é¢: <strong id="balance">åŠ è½½ä¸­...</strong></p>
      </div>
      <button onclick="resetAll()" class="btn btn-secondary">é‡ç½®æ•°æ®</button>
    </section>
  </div>

  <script>
    let currentToken = ''
    
    async function loginDeviceA() {
      const res = await fetch('/api/replay/unsafe/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username: 'alice', password: 'alice123' })
      })
      const data = await res.json()
      if (data.success) {
        currentToken = data.token
        document.getElementById('token-a').textContent = 'Token: ' + data.token
        document.getElementById('result-a').innerHTML = '<span style="color: green;">âœ… ç™»å½•æˆåŠŸ</span>'
      }
    }
    
    function copyToken() {
      if (currentToken) {
        navigator.clipboard.writeText(currentToken)
        alert('Token å·²å¤åˆ¶åˆ°å‰ªè´´æ¿')
      }
    }
    
    async function checkProfileA() {
      if (!currentToken) return alert('è¯·å…ˆç™»å½•')
      const res = await fetch('/api/replay/unsafe/profile', {
        headers: { 'Authorization': 'Bearer ' + currentToken }
      })
      const data = await res.json()
      document.getElementById('result-a').innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`
      loadBalance()
    }
    
    async function useStolen() {
      const token = document.getElementById('stolen-token').value
      if (!token) return alert('è¯·è¾“å…¥ Token')
      const res = await fetch('/api/replay/unsafe/profile', {
        headers: { 'Authorization': 'Bearer ' + token }
      })
      const data = await res.json()
      document.getElementById('result-b').innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`
    }
    
    async function transferStolen() {
      const token = document.getElementById('stolen-token').value
      if (!token) return alert('è¯·è¾“å…¥ Token')
      const res = await fetch('/api/replay/unsafe/transfer', {
        method: 'POST',
        headers: { 
          'Content-Type': 'application/json',
          'Authorization': 'Bearer ' + token 
        },
        body: JSON.stringify({ amount: 1000 })
      })
      const data = await res.json()
      document.getElementById('result-b').innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`
      loadBalance()
    }
    
    async function loadBalance() {
      const res = await fetch('/api/replay/unsafe/profile', {
        headers: { 'Authorization': 'Bearer ' + currentToken }
      })
      const data = await res.json()
      document.getElementById('balance').textContent = data.balance ? `Â¥${data.balance}` : 'æœªç™»å½•'
    }
    
    async function resetAll() {
      await fetch('/api/replay/reset', { method: 'POST' })
      currentToken = ''
      document.getElementById('token-a').textContent = 'Token: æœªç™»å½•'
      document.getElementById('result-a').textContent = 'ç™»å½•åæŸ¥çœ‹ç»“æœ...'
      document.getElementById('result-b').textContent = 'ç²˜è´´ Token åæ“ä½œ...'
      document.getElementById('stolen-token').value = ''
      document.getElementById('balance').textContent = 'Â¥10000'
    }
  </script>
</body>
</html>
