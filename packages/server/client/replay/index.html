<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Token é‡æ”¾æ”»å‡» - Security Lab</title>
  <link rel="stylesheet" href="../xss/style.css">
</head>
<body>
  <div class="container">
    <a href="/" class="back-link">â† è¿”å›é¦–é¡µ</a>
    <h1>ğŸ”„ Token / Session é‡æ”¾æ”»å‡»</h1>
    
    <div class="warning-box">
      <strong>âš ï¸ å­¦ä¹ ç›®çš„</strong>
      <p>é‡æ”¾æ”»å‡»æ˜¯æŒ‡æ”»å‡»è€…æˆªè·åˆæ³•çš„è®¤è¯å‡­è¯åï¼Œåœ¨å…¶ä»–è®¾å¤‡æˆ–æ—¶é—´é‡å¤ä½¿ç”¨</p>
    </div>

    <section>
      <h2>ğŸ“– æ”»å‡»åŸç†</h2>
      <div class="info-box">
        <pre>
1. ç”¨æˆ·åœ¨è®¾å¤‡ A ç™»å½•ï¼Œè·å¾— Token
2. æ”»å‡»è€…é€šè¿‡æŸç§æ–¹å¼è·å–è¯¥ Token
   - XSS çªƒå–
   - ç½‘ç»œå—…æ¢
   - æ—¥å¿—æ³„éœ²
3. æ”»å‡»è€…åœ¨è®¾å¤‡ B ä½¿ç”¨ç›¸åŒ Token
4. æœåŠ¡å™¨æ— æ³•åŒºåˆ†ï¼Œæ”»å‡»è€…è·å¾—ç”¨æˆ·æƒé™
        </pre>
      </div>
    </section>

    <section>
      <h2>ğŸ§ª å®éªŒåˆ—è¡¨</h2>
      
      <a href="attack.html" class="lab-card">
        <div class="lab-icon">ğŸ¯</div>
        <div class="lab-info">
          <h3>å®éªŒä¸€ï¼šToken é‡æ”¾æ”»å‡»</h3>
          <p>æ¼”ç¤ºå¦‚ä½•å¤åˆ¶ Token åœ¨å¦ä¸€è®¾å¤‡ä½¿ç”¨</p>
          <span class="difficulty hard">æ”»å‡»æ¼”ç¤º</span>
        </div>
      </a>

      <a href="defense.html" class="lab-card">
        <div class="lab-icon">ğŸ›¡ï¸</div>
        <div class="lab-info">
          <h3>å®éªŒäºŒï¼šé˜²é‡æ”¾æœºåˆ¶</h3>
          <p>è®¾å¤‡ç»‘å®šã€ä¸€æ¬¡æ€§ Tokenã€Nonce é˜²æŠ¤</p>
          <span class="difficulty medium">é˜²æŠ¤æ–¹æ¡ˆ</span>
        </div>
      </a>
    </section>

    <section>
      <h2>ğŸ”§ é˜²å¾¡æ–¹æ¡ˆ</h2>
      <table class="info-table">
        <tr><th>æ–¹æ¡ˆ</th><th>åŸç†</th><th>é€‚ç”¨åœºæ™¯</th></tr>
        <tr><td>è®¾å¤‡ç»‘å®š</td><td>Token ä¸è®¾å¤‡ ID å…³è”</td><td>ç§»åŠ¨ç«¯ App</td></tr>
        <tr><td>IP ç»‘å®š</td><td>Token ä¸ IP å…³è”</td><td>å›ºå®šç½‘ç»œç¯å¢ƒ</td></tr>
        <tr><td>Nonce</td><td>æ¯æ¬¡è¯·æ±‚å”¯ä¸€æ ‡è¯†</td><td>æ•æ„Ÿæ“ä½œ</td></tr>
        <tr><td>çŸ­æœ‰æ•ˆæœŸ</td><td>Token å¿«é€Ÿè¿‡æœŸ</td><td>é«˜å®‰å…¨åœºæ™¯</td></tr>
        <tr><td>åˆ·æ–°æœºåˆ¶</td><td>Access + Refresh Token</td><td>é€šç”¨æ–¹æ¡ˆ</td></tr>
      </table>
    </section>

    <section>
      <h2>ğŸ“Š å½“å‰ Session</h2>
      <div id="sessions" class="info-box">åŠ è½½ä¸­...</div>
      <button onclick="resetAll()" class="btn" style="margin-top: 10px;">é‡ç½®æ‰€æœ‰æ•°æ®</button>
    </section>
  </div>

  <script>
    async function loadSessions() {
      const res = await fetch('/api/replay/sessions')
      const data = await res.json()
      if (data.length === 0) {
        document.getElementById('sessions').innerHTML = '<p>æš‚æ— æ´»è·ƒ Session</p>'
      } else {
        document.getElementById('sessions').innerHTML = data.map(s => 
          `<div style="margin: 5px 0; padding: 5px; background: #0f3460; border-radius: 4px; color: #eee;">
            <strong>${s.username}</strong> - ${s.token}<br>
            <small style="color: #888;">è®¾å¤‡: ${s.deviceId || s.device?.substring(0, 30) || 'unknown'}...</small>
          </div>`
        ).join('')
      }
    }
    async function resetAll() {
      await fetch('/api/replay/reset', { method: 'POST' })
      loadSessions()
      alert('å·²é‡ç½®')
    }
    loadSessions()
  </script>
</body>
</html>
