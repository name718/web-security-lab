<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSP frame-ancestors é˜²æŠ¤ - Clickjacking Lab</title>
  <link rel="stylesheet" href="../xss/style.css">
  <style>
    .demo-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }
    @media (max-width: 768px) { .demo-container { grid-template-columns: 1fr; } }
    .demo-box { border: 2px solid #ddd; border-radius: 8px; overflow: hidden; }
    .demo-box.unsafe { border-color: #f44336; }
    .demo-box.safe { border-color: #2196f3; }
    .demo-header { padding: 10px 15px; font-weight: bold; }
    .demo-box.unsafe .demo-header { background: #ffebee; color: #c62828; }
    .demo-box.safe .demo-header { background: #e3f2fd; color: #1565c0; }
    .demo-content { height: 300px; background: #f5f5f5; }
    .demo-content iframe { width: 100%; height: 100%; border: none; }
    .header-display { background: #263238; color: #aed581; padding: 15px; border-radius: 8px; font-family: monospace; margin: 15px 0; }
  </style>
</head>
<body>
  <div class="container">
    <a href="index.html" class="back-link">â† è¿”å› Clickjacking Lab</a>
    <h1>ğŸ”’ å®éªŒä¸‰ï¼šCSP frame-ancestors é˜²æŠ¤</h1>
    <div class="info-box">
      <strong>CSP frame-ancestors</strong> æ˜¯ Content-Security-Policy çš„ä¸€ä¸ªæŒ‡ä»¤ï¼Œæ¯” X-Frame-Options æ›´çµæ´»
    </div>

    <section>
      <h2>ğŸ“– frame-ancestors è¯­æ³•</h2>
      <table class="info-table">
        <tr><th>å€¼</th><th>è¯´æ˜</th><th>ç¤ºä¾‹</th></tr>
        <tr><td><code>'none'</code></td><td>ç¦æ­¢ä»»ä½•é¡µé¢åµŒå…¥</td><td>ç­‰åŒäº X-Frame-Options: DENY</td></tr>
        <tr><td><code>'self'</code></td><td>åªå…è®¸åŒæºåµŒå…¥</td><td>ç­‰åŒäº X-Frame-Options: SAMEORIGIN</td></tr>
        <tr><td><code>åŸŸå</code></td><td>å…è®¸æŒ‡å®šåŸŸååµŒå…¥</td><td><code>https://trusted.com</code></td></tr>
        <tr><td><code>å¤šä¸ªå€¼</code></td><td>å…è®¸å¤šä¸ªæ¥æº</td><td><code>'self' https://a.com https://b.com</code></td></tr>
      </table>
    </section>

    <section>
      <h2>ğŸ® å¯¹æ¯”æ¼”ç¤º</h2>
      <div class="demo-container">
        <div class="demo-box unsafe">
          <div class="demo-header">âŒ æ— é˜²æŠ¤</div>
          <div class="demo-content">
            <iframe src="/api/clickjacking/unsafe/transfer-page"></iframe>
          </div>
        </div>
        <div class="demo-box safe">
          <div class="demo-header">âœ… CSP: frame-ancestors 'none'</div>
          <div class="demo-content">
            <iframe src="/api/clickjacking/safe/csp/transfer-page"></iframe>
          </div>
        </div>
      </div>
      <div class="info-box">
        <p>ğŸ‘† å³ä¾§é¡µé¢è¢« CSP ç­–ç•¥é˜»æ­¢åµŒå…¥ï¼ŒæŸ¥çœ‹ Console å¯è§é”™è¯¯</p>
      </div>
    </section>

    <section>
      <h2>ğŸ’» æœåŠ¡ç«¯å®ç°</h2>
      <pre><code>// Express.js
app.get('/transfer', (req, res) => {
  res.setHeader('Content-Security-Policy', "frame-ancestors 'none'")
  res.send(html)
})

// å…è®¸ç‰¹å®šåŸŸå
res.setHeader('Content-Security-Policy', "frame-ancestors 'self' https://trusted.com")

// Nginx
add_header Content-Security-Policy "frame-ancestors 'none'" always;

// Apache
Header always set Content-Security-Policy "frame-ancestors 'none'"</code></pre>
    </section>

    <section>
      <h2>ğŸ” å“åº”å¤´</h2>
      <div class="header-display">
        HTTP/1.1 200 OK<br>
        Content-Type: text/html<br>
        <span style="color: #64b5f6;">Content-Security-Policy: frame-ancestors 'none'</span>
      </div>
    </section>

    <section>
      <h2>âš¡ CSP vs X-Frame-Options</h2>
      <table class="info-table">
        <tr><th>ç‰¹æ€§</th><th>X-Frame-Options</th><th>CSP frame-ancestors</th></tr>
        <tr><td>å¤šåŸŸåæ”¯æŒ</td><td>âŒ</td><td>âœ…</td></tr>
        <tr><td>é€šé…ç¬¦</td><td>âŒ</td><td>âœ… <code>*.example.com</code></td></tr>
        <tr><td>æµè§ˆå™¨æ”¯æŒ</td><td>æ‰€æœ‰æµè§ˆå™¨</td><td>ç°ä»£æµè§ˆå™¨</td></tr>
        <tr><td>æ¨èç¨‹åº¦</td><td>ä½œä¸ºåå¤‡</td><td>âœ… é¦–é€‰</td></tr>
      </table>
      <div class="info-box" style="margin-top: 15px;">
        <strong>æœ€ä½³å®è·µï¼š</strong>åŒæ—¶è®¾ç½®ä¸¤ä¸ªå¤´ï¼Œç¡®ä¿å…¼å®¹æ€§
        <pre style="margin-top: 10px;"><code>X-Frame-Options: DENY
Content-Security-Policy: frame-ancestors 'none'</code></pre>
      </div>
    </section>
  </div>
</body>
</html>
