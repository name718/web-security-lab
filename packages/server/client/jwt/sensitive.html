<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å®éªŒä¸‰ï¼šæ•æ„Ÿä¿¡æ¯æ³„éœ²</title>
  <link rel="stylesheet" href="../xss/style.css">
</head>
<body>
  <div class="container">
    <nav class="nav">
      <a href="index.html">â† è¿”å› JWT Lab</a>
    </nav>

    <header>
      <h1>ğŸ‘ï¸ æ•æ„Ÿä¿¡æ¯æ³„éœ²</h1>
      <p class="subtitle">Sensitive Data Exposure</p>
    </header>

    <section>
      <h2>ğŸ“– æ¼æ´åŸç†</h2>
      <div class="warning-box">
        <strong>âš ï¸ é‡è¦è¯¯åŒº</strong>
        <p>JWT çš„ Payload <strong>ä¸æ˜¯åŠ å¯†çš„</strong>ï¼Œåªæ˜¯ Base64 ç¼–ç ï¼</p>
        <p>ä»»ä½•äººéƒ½å¯ä»¥è§£ç æŸ¥çœ‹å†…å®¹ï¼Œç­¾ååªä¿è¯æ•°æ®æœªè¢«ç¯¡æ”¹ã€‚</p>
      </div>
      
      <p style="margin-top: 1rem;">å¦‚æœåœ¨ Payload ä¸­å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼š</p>
      <ul style="margin: 0.5rem 0 0 1.5rem;">
        <li>å¯†ç ã€å¯†é’¥</li>
        <li>ä¿¡ç”¨å¡å·ã€èº«ä»½è¯å·</li>
        <li>ç§å¯†æ•°æ®</li>
      </ul>
      <p>è¿™äº›ä¿¡æ¯ä¼šè¢«ä»»ä½•è·å–åˆ° Token çš„äººçœ‹åˆ°ï¼</p>
    </section>

    <section>
      <h2>ğŸ§ª æ¼æ´æ¼”ç¤º</h2>
      
      <h3 style="margin: 1rem 0 0.5rem;">Step 1: è·å–åŒ…å«æ•æ„Ÿä¿¡æ¯çš„ Token</h3>
      <button class="btn" onclick="getSensitiveToken()">è·å– Token</button>
      <div id="tokenDisplay" class="token-display" style="margin-top: 0.5rem; word-break: break-all;">
        ç­‰å¾…è·å–...
      </div>

      <h3 style="margin: 1rem 0 0.5rem;">Step 2: è§£ç  Token</h3>
      <p>æ— éœ€å¯†é’¥ï¼Œç›´æ¥ Base64 è§£ç ï¼š</p>
      <button class="btn" onclick="decodeToken()">ğŸ” è§£ç æŸ¥çœ‹</button>
      <div id="decodedDisplay" style="margin-top: 0.5rem;"></div>

      <h3 style="margin: 1rem 0 0.5rem;">Step 3: æ‰‹åŠ¨è§£ç éªŒè¯</h3>
      <p>åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œï¼š</p>
      <pre><code id="consoleCode">// å¤åˆ¶ Token åæ‰§è¡Œ
const token = 'YOUR_TOKEN_HERE'
const payload = token.split('.')[1]
console.log(JSON.parse(atob(payload)))</code></pre>
    </section>

    <section>
      <h2>ğŸ”¬ é”™è¯¯ç¤ºä¾‹</h2>
      <pre><code>// âŒ é”™è¯¯ï¼šåœ¨ Payload ä¸­å­˜å‚¨æ•æ„Ÿä¿¡æ¯
const payload = {
  userId: 123,
  username: 'admin',
  password: 'admin123',      // ä¸åº”è¯¥æ”¾å¯†ç ï¼
  creditCard: '4111-xxxx',   // ä¸åº”è¯¥æ”¾ä¿¡ç”¨å¡ï¼
  ssn: '123-45-6789'         // ä¸åº”è¯¥æ”¾èº«ä»½è¯ï¼
}

// âœ… æ­£ç¡®ï¼šåªå­˜å‚¨å¿…è¦çš„éæ•æ„Ÿä¿¡æ¯
const payload = {
  userId: 123,
  username: 'admin',
  role: 'admin',
  iat: 1234567890,
  exp: 1234571490
}</code></pre>
    </section>

    <section>
      <h2>ğŸ›¡ï¸ å®‰å…¨å»ºè®®</h2>
      <ul style="margin-left: 1.5rem;">
        <li><strong>æœ€å°åŒ–åŸåˆ™</strong> - Payload åªå­˜å‚¨å¿…è¦ä¿¡æ¯</li>
        <li><strong>ä¸å­˜æ•æ„Ÿæ•°æ®</strong> - å¯†ç ã€å¯†é’¥ã€ä¸ªäººéšç§ç­‰</li>
        <li><strong>ä½¿ç”¨ JWE</strong> - å¦‚éœ€åŠ å¯†ï¼Œä½¿ç”¨ JSON Web Encryption</li>
        <li><strong>çŸ­æœŸæœ‰æ•ˆ</strong> - è®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´</li>
        <li><strong>HTTPS</strong> - é˜²æ­¢ Token åœ¨ä¼ è¾“ä¸­è¢«çªƒå–</li>
      </ul>
    </section>

    <section>
      <h2>ğŸ“Š JWT vs JWE</h2>
      <table style="width: 100%; border-collapse: collapse;">
        <thead>
          <tr><th>ç‰¹æ€§</th><th>JWT (JWS)</th><th>JWE</th></tr>
        </thead>
        <tbody>
          <tr>
            <td>Payload</td>
            <td>Base64 ç¼–ç ï¼ˆå¯è¯»ï¼‰</td>
            <td>åŠ å¯†ï¼ˆä¸å¯è¯»ï¼‰</td>
          </tr>
          <tr>
            <td>ç”¨é€”</td>
            <td>èº«ä»½éªŒè¯ã€æˆæƒ</td>
            <td>ä¼ è¾“æ•æ„Ÿæ•°æ®</td>
          </tr>
          <tr>
            <td>æ€§èƒ½</td>
            <td>å¿«</td>
            <td>è¾ƒæ…¢</td>
          </tr>
        </tbody>
      </table>
    </section>
  </div>

  <script>
    let currentToken = ''

    async function getSensitiveToken() {
      const res = await fetch('/api/jwt/login/sensitive', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username: 'admin', password: 'admin123' })
      })
      const data = await res.json()
      
      if (data.success) {
        currentToken = data.token
        document.getElementById('tokenDisplay').innerHTML = `
          <code>${data.token}</code>
          <p style="margin-top: 0.5rem; color: #ff6b6b;">${data.warning}</p>
        `
        document.getElementById('consoleCode').textContent = 
          `const token = '${data.token}'\nconst payload = token.split('.')[1]\nconsole.log(JSON.parse(atob(payload)))`
      }
    }

    async function decodeToken() {
      if (!currentToken) {
        alert('è¯·å…ˆè·å– Token')
        return
      }

      const res = await fetch('/api/jwt/decode', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token: currentToken })
      })
      const data = await res.json()

      if (data.success) {
        document.getElementById('decodedDisplay').innerHTML = `
          <div class="warning-box">
            <strong>ğŸš¨ æ•æ„Ÿä¿¡æ¯æš´éœ²ï¼</strong>
            <p><strong>Header:</strong></p>
            <pre>${JSON.stringify(data.header, null, 2)}</pre>
            <p><strong>Payload:</strong></p>
            <pre>${JSON.stringify(data.payload, null, 2)}</pre>
            <p style="color: #ff6b6b; margin-top: 1rem;">
              âš ï¸ å¯†ç ã€ä¿¡ç”¨å¡ã€èº«ä»½è¯å·å…¨éƒ¨æš´éœ²ï¼
            </p>
          </div>
        `
      }
    }
  </script>

  <style>
    th, td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid #0f3460;
    }
    th { background: #0f3460; }
  </style>
</body>
</html>
