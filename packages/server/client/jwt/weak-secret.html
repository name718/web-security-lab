<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å®éªŒäºŒï¼šå¼±å¯†é’¥çˆ†ç ´</title>
  <link rel="stylesheet" href="../xss/style.css">
</head>
<body>
  <div class="container">
    <nav class="nav">
      <a href="index.html">â† è¿”å› JWT Lab</a>
    </nav>

    <header>
      <h1>ğŸ”‘ å¼±å¯†é’¥çˆ†ç ´</h1>
      <p class="subtitle">Weak Secret Brute Force</p>
    </header>

    <section>
      <h2>ğŸ“– æ¼æ´åŸç†</h2>
      <p>å¦‚æœ JWT ä½¿ç”¨å¼±å¯†é’¥ï¼ˆå¦‚ "secret"ã€"password"ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥ï¼š</p>
      <ol style="margin: 1rem 0 0 1.5rem;">
        <li>è·å–ä¸€ä¸ªæœ‰æ•ˆçš„ JWT</li>
        <li>ä½¿ç”¨å¸¸è§å¯†é’¥å­—å…¸è¿›è¡Œçˆ†ç ´</li>
        <li>æ‰¾åˆ°æ­£ç¡®çš„å¯†é’¥åï¼Œå¯ä»¥ä¼ªé€ ä»»æ„ Token</li>
      </ol>
      <div class="warning-box">
        <p>å¸¸è§å¼±å¯†é’¥ï¼šsecret, password, 123456, admin, key, jwt, token...</p>
      </div>
    </section>

    <section>
      <h2>ğŸ§ª æ”»å‡»æ¼”ç¤º</h2>
      
      <h3 style="margin: 1rem 0 0.5rem;">Step 1: è·å–ç›®æ ‡ Token</h3>
      <button class="btn" onclick="getToken()">è·å– Tokenï¼ˆå¼±å¯†é’¥ç­¾å‘ï¼‰</button>
      <div id="targetToken" class="token-display" style="margin-top: 0.5rem; word-break: break-all;">
        ç­‰å¾…è·å–...
      </div>

      <h3 style="margin: 1rem 0 0.5rem;">Step 2: å­—å…¸çˆ†ç ´</h3>
      <p>ä½¿ç”¨å¸¸è§å¯†é’¥å­—å…¸å°è¯•çˆ†ç ´ï¼š</p>
      <div id="wordlist" style="background: #0f3460; padding: 1rem; border-radius: 4px; margin: 0.5rem 0;">
        åŠ è½½ä¸­...
      </div>
      <button class="btn" onclick="bruteforce()">ğŸ”“ å¼€å§‹çˆ†ç ´</button>
      <div id="bruteResult" style="margin-top: 0.5rem;"></div>

      <h3 style="margin: 1rem 0 0.5rem;">Step 3: ä¼ªé€ ç®¡ç†å‘˜ Token</h3>
      <p>ä½¿ç”¨çˆ†ç ´å‡ºçš„å¯†é’¥ä¼ªé€ ç®¡ç†å‘˜èº«ä»½ï¼š</p>
      <button class="btn" onclick="forgeAdmin()" id="forgeBtn" disabled>ğŸ”§ ä¼ªé€ ç®¡ç†å‘˜ Token</button>
      <div id="forgedToken" style="margin-top: 0.5rem;"></div>
    </section>

    <section>
      <h2>ğŸ”¬ çˆ†ç ´åŸç†</h2>
      <pre><code>// çˆ†ç ´é€»è¾‘
const wordlist = ['secret', 'password', '123456', ...]

for (const secret of wordlist) {
  const expectedSig = HMAC_SHA256(header + '.' + payload, secret)
  
  if (expectedSig === token.signature) {
    console.log('å¯†é’¥æ‰¾åˆ°:', secret)
    break
  }
}</code></pre>
    </section>

    <section>
      <h2>ğŸ›¡ï¸ é˜²å¾¡æ–¹æ³•</h2>
      <ul style="margin-left: 1.5rem;">
        <li><strong>ä½¿ç”¨å¼ºå¯†é’¥</strong> - è‡³å°‘ 256 ä½ï¼ˆ32 å­—èŠ‚ï¼‰éšæœºå¯†é’¥</li>
        <li><strong>ä½¿ç”¨éå¯¹ç§°ç®—æ³•</strong> - RS256 ä½¿ç”¨å…¬ç§é’¥å¯¹</li>
        <li><strong>å¯†é’¥è½®æ¢</strong> - å®šæœŸæ›´æ¢å¯†é’¥</li>
        <li><strong>å¯†é’¥ç®¡ç†</strong> - ä½¿ç”¨ KMS ç­‰å¯†é’¥ç®¡ç†æœåŠ¡</li>
      </ul>
      
      <pre style="margin-top: 1rem;"><code>// ç”Ÿæˆå¼ºå¯†é’¥
const crypto = require('crypto')
const secret = crypto.randomBytes(32).toString('hex')
// ä¾‹å¦‚: 'a3f2b8c9d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1'</code></pre>
    </section>
  </div>

  <script>
    let targetToken = ''
    let foundSecret = ''

    async function getToken() {
      const res = await fetch('/api/jwt/login/weak', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username: 'user', password: '123456' })
      })
      const data = await res.json()
      
      if (data.success) {
        targetToken = data.token
        document.getElementById('targetToken').innerHTML = `
          <code>${data.token}</code>
          <p style="margin-top: 0.5rem; color: #fcc419;">æç¤º: å¯†é’¥æ˜¯ "${data.secret}"</p>
        `
      }
    }

    // åŠ è½½å­—å…¸
    fetch('/api/jwt/wordlist')
      .then(r => r.json())
      .then(list => {
        document.getElementById('wordlist').innerHTML = 
          `<code>${list.join(', ')}</code>`
      })

    async function bruteforce() {
      if (!targetToken) {
        alert('è¯·å…ˆè·å– Token')
        return
      }

      const resultEl = document.getElementById('bruteResult')
      resultEl.innerHTML = '<div class="info-box">ğŸ”„ çˆ†ç ´ä¸­...</div>'

      const wordlistRes = await fetch('/api/jwt/wordlist')
      const wordlist = await wordlistRes.json()

      const res = await fetch('/api/jwt/bruteforce', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token: targetToken, wordlist })
      })
      const data = await res.json()

      if (data.success) {
        foundSecret = data.secret
        document.getElementById('forgeBtn').disabled = false
        resultEl.innerHTML = `
          <div class="warning-box">
            <strong>ğŸš¨ çˆ†ç ´æˆåŠŸï¼</strong>
            <p>æ‰¾åˆ°å¯†é’¥: <code>${data.secret}</code></p>
            <p>ç°åœ¨å¯ä»¥ä¼ªé€ ä»»æ„ Tokenï¼</p>
          </div>
        `
      } else {
        resultEl.innerHTML = `
          <div class="success-box">
            <strong>âœ… çˆ†ç ´å¤±è´¥</strong>
            <p>${data.message}</p>
          </div>
        `
      }
    }

    async function forgeAdmin() {
      if (!foundSecret) {
        alert('è¯·å…ˆçˆ†ç ´å‡ºå¯†é’¥')
        return
      }

      // ä½¿ç”¨æ‰¾åˆ°çš„å¯†é’¥ä¼ªé€ ç®¡ç†å‘˜ Token
      const payload = {
        id: 1,
        username: 'admin',
        role: 'admin',
        iat: Math.floor(Date.now() / 1000)
      }

      const res = await fetch('/api/jwt/forge', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ payload, algorithm: 'HS256', secret: foundSecret })
      })
      const data = await res.json()

      if (data.success) {
        document.getElementById('forgedToken').innerHTML = `
          <div class="warning-box">
            <strong>ğŸš¨ ä¼ªé€ æˆåŠŸï¼</strong>
            <p>ç®¡ç†å‘˜ Token:</p>
            <code style="word-break: break-all;">${data.token}</code>
            <p style="margin-top: 0.5rem;">ä½¿ç”¨æ­¤ Token å¯ä»¥å†’å……ç®¡ç†å‘˜ï¼</p>
          </div>
        `
      }
    }
  </script>
</body>
</html>
