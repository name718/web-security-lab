<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å®éªŒä¸€ï¼šHTTP Flood æ”»å‡»</title>
  <link rel="stylesheet" href="../xss/style.css">
  <style>
    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 1rem;
      margin: 1rem 0;
    }
    .stat-card {
      background: #0f3460;
      padding: 1rem;
      border-radius: 8px;
      text-align: center;
    }
    .stat-card .value {
      font-size: 2rem;
      font-weight: bold;
      color: #4dabf7;
    }
    .stat-card .label {
      color: #888;
      font-size: 0.85rem;
    }
    .stat-card.danger .value { color: #ff6b6b; }
    .stat-card.success .value { color: #51cf66; }
    .progress-bar {
      background: #0f3460;
      border-radius: 4px;
      height: 20px;
      overflow: hidden;
      margin: 0.5rem 0;
    }
    .progress-bar .fill {
      height: 100%;
      background: #4dabf7;
      transition: width 0.3s;
    }
    .progress-bar .fill.danger { background: #ff6b6b; }
    .progress-bar .fill.warning { background: #fcc419; }
    .log-container {
      background: #0f3460;
      border-radius: 4px;
      padding: 1rem;
      max-height: 200px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 0.85rem;
    }
    .log-entry {
      padding: 0.25rem 0;
      border-bottom: 1px solid #1a1a2e;
    }
    .controls {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      align-items: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <nav class="nav">
      <a href="index.html">â† è¿”å› DDoS Lab</a>
    </nav>

    <header>
      <h1>âš”ï¸ HTTP Flood æ”»å‡»æ¨¡æ‹Ÿ</h1>
      <p class="subtitle">è§‚å¯ŸæœåŠ¡å™¨åœ¨å¤§é‡è¯·æ±‚ä¸‹çš„è¡¨ç°</p>
    </header>

    <section>
      <h2>ğŸ“Š æœåŠ¡å™¨çŠ¶æ€ç›‘æ§</h2>
      <div class="dashboard">
        <div class="stat-card">
          <div class="value" id="totalRequests">0</div>
          <div class="label">æ€»è¯·æ±‚æ•°</div>
        </div>
        <div class="stat-card">
          <div class="value" id="rps">0</div>
          <div class="label">è¯·æ±‚/ç§’</div>
        </div>
        <div class="stat-card" id="connectionsCard">
          <div class="value" id="connections">0</div>
          <div class="label">æ´»è·ƒè¿æ¥</div>
        </div>
        <div class="stat-card" id="statusCard">
          <div class="value" id="serverStatus">æ­£å¸¸</div>
          <div class="label">æœåŠ¡å™¨çŠ¶æ€</div>
        </div>
      </div>
      
      <div>
        <label>æœåŠ¡å™¨è´Ÿè½½:</label>
        <div class="progress-bar">
          <div class="fill" id="loadBar" style="width: 0%"></div>
        </div>
      </div>
    </section>

    <section>
      <h2>ğŸ® æ”»å‡»æ§åˆ¶å°</h2>
      
      <div class="controls">
        <div>
          <label>å¹¶å‘æ•°:</label>
          <input type="number" id="concurrency" value="50" min="1" max="500" style="width: 80px;">
        </div>
        <div>
          <label>æŒç»­æ—¶é—´(ç§’):</label>
          <input type="number" id="duration" value="5" min="1" max="30" style="width: 80px;">
        </div>
        <button class="btn" id="attackBtn" onclick="startAttack()">ğŸš€ å‘èµ·æ”»å‡»</button>
        <button class="btn btn-secondary" onclick="stopAttack()">â¹ï¸ åœæ­¢</button>
        <button class="btn btn-secondary" onclick="resetServer()">ğŸ”„ é‡ç½®</button>
      </div>

      <div id="attackStatus" style="margin-top: 1rem;"></div>
    </section>

    <section>
      <h2>ğŸ“‹ è¯·æ±‚æ—¥å¿—</h2>
      <div class="log-container" id="logContainer">
        <div class="log-entry" style="color: #888;">ç­‰å¾…è¯·æ±‚...</div>
      </div>
    </section>

    <section>
      <h2>ğŸ“– æ”»å‡»åŸç†</h2>
      <div class="info-box">
        <p><strong>HTTP Flood</strong> æ˜¯æœ€å¸¸è§çš„åº”ç”¨å±‚ DDoS æ”»å‡»ï¼š</p>
        <ol style="margin: 0.5rem 0 0 1.5rem;">
          <li>æ”»å‡»è€…æ§åˆ¶å¤§é‡"è‚‰é¸¡"æˆ–ä½¿ç”¨ä»£ç†</li>
          <li>åŒæ—¶å‘ç›®æ ‡æœåŠ¡å™¨å‘é€å¤§é‡ HTTP è¯·æ±‚</li>
          <li>æœåŠ¡å™¨èµ„æºè¢«è€—å°½ï¼ˆCPUã€å†…å­˜ã€è¿æ¥æ•°ï¼‰</li>
          <li>æ­£å¸¸ç”¨æˆ·æ— æ³•è®¿é—®æœåŠ¡</li>
        </ol>
      </div>
      
      <pre><code>// æ”»å‡»ä»£ç ç¤ºæ„
for (let i = 0; i < 1000; i++) {
  fetch('/api/ddos/api')  // å¤§é‡å¹¶å‘è¯·æ±‚
}</code></pre>
    </section>

    <section>
      <h2>ğŸ›¡ï¸ è§‚å¯Ÿè¦ç‚¹</h2>
      <ul style="margin-left: 1.5rem;">
        <li>è§‚å¯Ÿ"æ´»è·ƒè¿æ¥"æ•°é‡ä¸Šå‡</li>
        <li>å½“è¿æ¥æ•°è¶…è¿‡é˜ˆå€¼ï¼ŒæœåŠ¡å™¨çŠ¶æ€å˜ä¸º"è¿‡è½½"</li>
        <li>å“åº”æ—¶é—´æ˜¾è‘—å¢åŠ </li>
        <li>éƒ¨åˆ†è¯·æ±‚è¿”å› 503 é”™è¯¯</li>
      </ul>
    </section>
  </div>

  <script>
    let attackInterval = null
    let isAttacking = false

    // å®šæ—¶åˆ·æ–°çŠ¶æ€
    setInterval(updateStatus, 500)

    async function updateStatus() {
      try {
        const res = await fetch('/api/ddos/status')
        const data = await res.json()
        
        document.getElementById('totalRequests').textContent = data.totalRequests
        document.getElementById('rps').textContent = data.requestsPerSecond
        document.getElementById('connections').textContent = data.activeConnections
        
        const load = Math.round(data.activeConnections / data.maxConnections * 100)
        const loadBar = document.getElementById('loadBar')
        loadBar.style.width = `${Math.min(load, 100)}%`
        loadBar.className = 'fill' + (load > 80 ? ' danger' : load > 50 ? ' warning' : '')
        
        const statusEl = document.getElementById('serverStatus')
        const statusCard = document.getElementById('statusCard')
        const connectionsCard = document.getElementById('connectionsCard')
        
        if (data.isOverloaded) {
          statusEl.textContent = 'è¿‡è½½!'
          statusCard.className = 'stat-card danger'
          connectionsCard.className = 'stat-card danger'
        } else {
          statusEl.textContent = 'æ­£å¸¸'
          statusCard.className = 'stat-card success'
          connectionsCard.className = 'stat-card'
        }
      } catch (e) {
        document.getElementById('serverStatus').textContent = 'æ— å“åº”'
      }
    }

    async function updateLogs() {
      try {
        const res = await fetch('/api/ddos/logs')
        const logs = await res.json()
        
        const container = document.getElementById('logContainer')
        if (logs.length === 0) {
          container.innerHTML = '<div class="log-entry" style="color: #888;">æš‚æ— æ—¥å¿—</div>'
          return
        }
        
        container.innerHTML = logs.slice(0, 20).map(log => 
          `<div class="log-entry">[${log.time}] ${log.ip} â†’ ${log.path}</div>`
        ).join('')
      } catch (e) {}
    }

    async function startAttack() {
      if (isAttacking) return
      
      const concurrency = parseInt(document.getElementById('concurrency').value)
      const duration = parseInt(document.getElementById('duration').value)
      
      isAttacking = true
      document.getElementById('attackBtn').disabled = true
      document.getElementById('attackStatus').innerHTML = 
        `<div class="warning-box">ğŸš€ æ”»å‡»è¿›è¡Œä¸­... å¹¶å‘: ${concurrency}, æŒç»­: ${duration}ç§’</div>`
      
      const startTime = Date.now()
      let requestCount = 0
      let successCount = 0
      let errorCount = 0
      
      // å‘èµ·æ”»å‡»
      attackInterval = setInterval(async () => {
        if (Date.now() - startTime > duration * 1000) {
          stopAttack()
          return
        }
        
        // å¹¶å‘è¯·æ±‚
        const promises = []
        for (let i = 0; i < concurrency; i++) {
          promises.push(
            fetch('/api/ddos/api')
              .then(r => {
                requestCount++
                if (r.ok) successCount++
                else errorCount++
              })
              .catch(() => {
                requestCount++
                errorCount++
              })
          )
        }
        
        await Promise.all(promises)
        updateLogs()
      }, 100)
      
      // æ”»å‡»ç»“æŸåæ˜¾ç¤ºç»Ÿè®¡
      setTimeout(() => {
        if (!isAttacking) return
        stopAttack()
        document.getElementById('attackStatus').innerHTML = `
          <div class="info-box">
            <strong>æ”»å‡»å®Œæˆ</strong>
            <p>æ€»è¯·æ±‚: ${requestCount}</p>
            <p>æˆåŠŸ: ${successCount} | å¤±è´¥: ${errorCount}</p>
            <p>é”™è¯¯ç‡: ${(errorCount / requestCount * 100).toFixed(1)}%</p>
          </div>
        `
      }, duration * 1000 + 500)
    }

    function stopAttack() {
      isAttacking = false
      if (attackInterval) {
        clearInterval(attackInterval)
        attackInterval = null
      }
      document.getElementById('attackBtn').disabled = false
      if (!document.getElementById('attackStatus').innerHTML.includes('æ”»å‡»å®Œæˆ')) {
        document.getElementById('attackStatus').innerHTML = 
          '<div class="success-box">æ”»å‡»å·²åœæ­¢</div>'
      }
    }

    async function resetServer() {
      await fetch('/api/ddos/reset', { method: 'POST' })
      document.getElementById('attackStatus').innerHTML = ''
      updateLogs()
    }
  </script>
</body>
</html>
