<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é”™è¯¯å †æ ˆæ³„éœ² - æ•æ„Ÿä¿¡æ¯æ³„éœ²</title>
  <link rel="stylesheet" href="../xss/style.css">
  <style>
    .leak-data { background: #1a1a2e; color: #0f0; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 12px; max-height: 400px; overflow: auto; white-space: pre-wrap; }
    .compare-box { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    @media (max-width: 768px) { .compare-box { grid-template-columns: 1fr; } }
    .unsafe-box { border: 2px solid #f44336; border-radius: 8px; padding: 15px; }
    .safe-box { border: 2px solid #4caf50; border-radius: 8px; padding: 15px; }
  </style>
</head>
<body>
  <div class="container">
    <a href="index.html" class="back-link">â† è¿”å›æ•æ„Ÿä¿¡æ¯æ³„éœ²</a>
    <h1>ğŸ’¥ å®éªŒäºŒï¼šé”™è¯¯å †æ ˆæ³„éœ²</h1>

    <div class="warning-box">
      <strong>âš ï¸ æ¼æ´åœºæ™¯</strong>
      <p>æœåŠ¡å™¨é”™è¯¯æ—¶è¿”å›è¯¦ç»†å †æ ˆä¿¡æ¯ï¼Œæš´éœ²ä»£ç è·¯å¾„ã€æ¡†æ¶ç‰ˆæœ¬ã€ç”šè‡³é…ç½®ä¿¡æ¯</p>
    </div>

    <section>
      <h2>ğŸ® å¯¹æ¯”æ¼”ç¤º</h2>
      <div class="compare-box">
        <div class="unsafe-box">
          <h3>âŒ ä¸å®‰å…¨å“åº”</h3>
          <button onclick="fetchUnsafe()" class="btn">è§¦å‘é”™è¯¯</button>
          <div class="leak-data" id="unsafe-result" style="margin-top: 10px;">ç‚¹å‡»æŒ‰é’®...</div>
        </div>
        <div class="safe-box">
          <h3>âœ… å®‰å…¨å“åº”</h3>
          <button onclick="fetchSafe()" class="btn">è§¦å‘é”™è¯¯</button>
          <div class="leak-data" id="safe-result" style="margin-top: 10px; color: #4caf50;">ç‚¹å‡»æŒ‰é’®...</div>
        </div>
      </div>
    </section>

    <section>
      <h2>ğŸ’€ å †æ ˆä¿¡æ¯æ³„éœ²çš„å±å®³</h2>
      <ul>
        <li><strong>ä»£ç è·¯å¾„</strong> - æš´éœ²æœåŠ¡å™¨ç›®å½•ç»“æ„</li>
        <li><strong>æ¡†æ¶ç‰ˆæœ¬</strong> - å¯é’ˆå¯¹æ€§æŸ¥æ‰¾å·²çŸ¥æ¼æ´</li>
        <li><strong>æ•°æ®åº“ä¿¡æ¯</strong> - è¿æ¥å­—ç¬¦ä¸²å¯èƒ½åŒ…å«å¯†ç </li>
        <li><strong>ä¸šåŠ¡é€»è¾‘</strong> - å‡½æ•°åæš´éœ²ä¸šåŠ¡å®ç°</li>
      </ul>
    </section>

    <section>
      <h2>ğŸ›¡ï¸ æ­£ç¡®çš„é”™è¯¯å¤„ç†</h2>
      <pre><code>// âŒ é”™è¯¯åšæ³•
app.use((err, req, res, next) => {
  res.status(500).json({
    error: err.message,
    stack: err.stack  // æš´éœ²å †æ ˆï¼
  })
})

// âœ… æ­£ç¡®åšæ³•
app.use((err, req, res, next) => {
  console.error(err)  // åªåœ¨æœåŠ¡ç«¯è®°å½•
  res.status(500).json({
    error: 'Internal Server Error',
    requestId: generateRequestId()  // ç”¨äºè¿½è¸ª
  })
})</code></pre>
    </section>
  </div>

  <script>
    async function fetchUnsafe() {
      const res = await fetch('/api/infoleak/unsafe/error')
      const data = await res.json()
      document.getElementById('unsafe-result').textContent = JSON.stringify(data, null, 2)
    }
    async function fetchSafe() {
      const res = await fetch('/api/infoleak/safe/error')
      const data = await res.json()
      document.getElementById('safe-result').textContent = JSON.stringify(data, null, 2)
    }
  </script>
</body>
</html>
