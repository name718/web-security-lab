<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ’åº“é˜²æŠ¤ - Security Lab</title>
  <link rel="stylesheet" href="../xss/style.css">
  <style>
    .defense-box { border: 2px solid #4caf50; padding: 15px; border-radius: 8px; margin: 15px 0; background: #f1f8e9; }
    .test-result { padding: 10px; margin-top: 10px; border-radius: 4px; }
  </style>
</head>
<body>
  <div class="container">
    <a href="index.html" class="back-link">â† è¿”å›æ’åº“æ”»å‡»</a>
    <h1>ğŸ›¡ï¸ å®éªŒäºŒï¼šæ’åº“é˜²æŠ¤</h1>

    <div class="info-box">
      <strong>é˜²æŠ¤ç­–ç•¥</strong>
      <p>é€šè¿‡å¤šå±‚é˜²æŠ¤æœºåˆ¶ï¼Œå¤§å¹…å¢åŠ æ’åº“æ”»å‡»çš„æˆæœ¬</p>
    </div>

    <section>
      <h2>ğŸ” é˜²æŠ¤æ–¹æ¡ˆä¸€ï¼šç™»å½•é™æµ</h2>
      <div class="defense-box">
        <p>é™åˆ¶åŒä¸€ IP çš„ç™»å½•å°è¯•æ¬¡æ•°ï¼Œè¶…è¿‡é˜ˆå€¼åä¸´æ—¶å°ç¦</p>
        <div>
          <input type="email" id="email1" value="alice@example.com" style="padding: 8px; margin: 5px;">
          <input type="password" id="password1" value="wrong" style="padding: 8px; margin: 5px;">
          <button onclick="testRateLimit()" class="btn">å°è¯•ç™»å½• (é™æµä¿æŠ¤)</button>
        </div>
        <div id="rate-result" class="test-result"></div>
        <p style="margin-top: 10px;"><small>è¿ç»­å¤±è´¥ 5 æ¬¡åå°†è¢«ä¸´æ—¶å°ç¦ 60 ç§’</small></p>
      </div>
      
      <pre><code>// é™æµå®ç°
const ipAttempts = {}

app.post('/login', (req, res) => {
  const ip = req.ip
  if (ipAttempts[ip] > 5) {
    return res.status(429).json({ error: 'è¯·æ±‚è¿‡äºé¢‘ç¹' })
  }
  ipAttempts[ip]++
  // ... éªŒè¯é€»è¾‘
})</code></pre>
    </section>

    <section>
      <h2>ğŸ¤– é˜²æŠ¤æ–¹æ¡ˆäºŒï¼šéªŒè¯ç </h2>
      <div class="defense-box">
        <p>è¦æ±‚ç”¨æˆ·å®ŒæˆéªŒè¯ç ï¼Œé˜»æ­¢è‡ªåŠ¨åŒ–æ”»å‡»</p>
        <div>
          <input type="email" id="email2" value="alice@example.com" style="padding: 8px; margin: 5px;">
          <input type="password" id="password2" value="alice123" style="padding: 8px; margin: 5px;">
        </div>
        <div style="margin: 10px 0;">
          <label>
            <input type="checkbox" id="captcha" onchange="updateCaptcha()"> 
            âœ… æˆ‘ä¸æ˜¯æœºå™¨äºº (æ¨¡æ‹ŸéªŒè¯ç )
          </label>
        </div>
        <button onclick="testCaptcha()" class="btn">ç™»å½• (éœ€éªŒè¯ç )</button>
        <div id="captcha-result" class="test-result"></div>
      </div>
    </section>

    <section>
      <h2>ğŸ“± é˜²æŠ¤æ–¹æ¡ˆä¸‰ï¼šå¤šå› ç´ è®¤è¯ (MFA)</h2>
      <div class="defense-box">
        <p>å³ä½¿å¯†ç è¢«æ’åº“æˆåŠŸï¼Œæ²¡æœ‰ç¬¬äºŒå› ç´ ä¹Ÿæ— æ³•ç™»å½•</p>
        <ul>
          <li>çŸ­ä¿¡éªŒè¯ç </li>
          <li>TOTP åŠ¨æ€ä»¤ç‰Œ (Google Authenticator)</li>
          <li>ç¡¬ä»¶å¯†é’¥ (YubiKey)</li>
          <li>ç”Ÿç‰©è¯†åˆ«</li>
        </ul>
      </div>
    </section>

    <section>
      <h2>ğŸ” é˜²æŠ¤æ–¹æ¡ˆå››ï¼šå¼‚å¸¸æ£€æµ‹</h2>
      <div class="info-box">
        <table class="info-table">
          <tr><th>æ£€æµ‹é¡¹</th><th>å¼‚å¸¸ç‰¹å¾</th><th>å“åº”</th></tr>
          <tr><td>ç™»å½•é¢‘ç‡</td><td>çŸ­æ—¶é—´å¤§é‡å°è¯•</td><td>é™æµ/å°ç¦</td></tr>
          <tr><td>åœ°ç†ä½ç½®</td><td>å¼‚åœ°ç™»å½•</td><td>äºŒæ¬¡éªŒè¯</td></tr>
          <tr><td>è®¾å¤‡æŒ‡çº¹</td><td>æ–°è®¾å¤‡</td><td>é‚®ä»¶ç¡®è®¤</td></tr>
          <tr><td>è¡Œä¸ºåˆ†æ</td><td>æœºå™¨äººç‰¹å¾</td><td>éªŒè¯ç </td></tr>
        </table>
      </div>
    </section>

    <section>
      <h2>ğŸ‘¤ ç”¨æˆ·ä¾§é˜²æŠ¤</h2>
      <div class="info-box">
        <ul>
          <li>âœ… ä½¿ç”¨å¯†ç ç®¡ç†å™¨ï¼Œæ¯ä¸ªç½‘ç«™ä¸åŒå¯†ç </li>
          <li>âœ… å¯ç”¨åŒå› ç´ è®¤è¯</li>
          <li>âœ… å®šæœŸæ£€æŸ¥ haveibeenpwned.com</li>
          <li>âœ… æ”¶åˆ°å¼‚å¸¸ç™»å½•æé†’ç«‹å³ä¿®æ”¹å¯†ç </li>
        </ul>
      </div>
    </section>

    <section>
      <h2>ğŸ“‹ é˜²æŠ¤æ£€æŸ¥æ¸…å•</h2>
      <table class="info-table">
        <tr><th>æªæ–½</th><th>æ•ˆæœ</th><th>å®ç°éš¾åº¦</th></tr>
        <tr><td>ç™»å½•é™æµ</td><td>â­â­â­</td><td>ç®€å•</td></tr>
        <tr><td>éªŒè¯ç </td><td>â­â­â­â­</td><td>ç®€å•</td></tr>
        <tr><td>MFA</td><td>â­â­â­â­â­</td><td>ä¸­ç­‰</td></tr>
        <tr><td>å¼‚å¸¸æ£€æµ‹</td><td>â­â­â­â­</td><td>å¤æ‚</td></tr>
        <tr><td>å¯†ç æ³„éœ²æ£€æµ‹</td><td>â­â­â­</td><td>ä¸­ç­‰</td></tr>
      </table>
    </section>
  </div>

  <script>
    let attemptCount = 0
    
    async function testRateLimit() {
      const email = document.getElementById('email1').value
      const password = document.getElementById('password1').value
      
      attemptCount++
      
      const res = await fetch('/api/credential/safe/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      })
      const data = await res.json()
      
      const resultDiv = document.getElementById('rate-result')
      if (res.status === 429) {
        resultDiv.innerHTML = `<div style="background: #3d1f1f; padding: 10px; border-radius: 4px; color: #ff6b6b;">
          ğŸš« ${data.error}<br>
          <small>è¯·ç­‰å¾… ${data.retryAfter} ç§’åé‡è¯•</small>
        </div>`
      } else if (data.success) {
        resultDiv.innerHTML = `<div style="background: #1b4332; padding: 10px; border-radius: 4px; color: #4caf50;">
          âœ… ${data.message}
        </div>`
      } else {
        resultDiv.innerHTML = `<div style="background: #3d3d1f; padding: 10px; border-radius: 4px; color: #fcc419;">
          âŒ ${data.error}<br>
          <small>å‰©ä½™å°è¯•æ¬¡æ•°: ${data.remainingAttempts}</small>
        </div>`
      }
    }
    
    function updateCaptcha() {
      // æ¨¡æ‹ŸéªŒè¯ç çŠ¶æ€
    }
    
    async function testCaptcha() {
      const email = document.getElementById('email2').value
      const password = document.getElementById('password2').value
      const captchaChecked = document.getElementById('captcha').checked
      
      const res = await fetch('/api/credential/safe/login-captcha', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          email, 
          password, 
          captcha: captchaChecked ? 'VALID' : null 
        })
      })
      const data = await res.json()
      
      const resultDiv = document.getElementById('captcha-result')
      if (data.requireCaptcha) {
        resultDiv.innerHTML = `<div style="background: #3d3d1f; padding: 10px; border-radius: 4px; color: #fcc419;">
          ğŸ¤– ${data.error}<br>
          <small>è¯·å…ˆå®ŒæˆéªŒè¯ç </small>
        </div>`
      } else if (data.success) {
        resultDiv.innerHTML = `<div style="background: #1b4332; padding: 10px; border-radius: 4px; color: #4caf50;">
          âœ… ${data.message}
        </div>`
      } else {
        resultDiv.innerHTML = `<div style="background: #3d1f1f; padding: 10px; border-radius: 4px; color: #ff6b6b;">
          âŒ ${data.error}
        </div>`
      }
    }
  </script>
</body>
</html>
