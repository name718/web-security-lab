<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å®éªŒä¸€ï¼šåå°„å‹ XSS</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <nav class="nav">
      <a href="index.html">â† è¿”å›é¦–é¡µ</a>
    </nav>

    <header>
      <h1>ğŸ” å®éªŒä¸€ï¼šåå°„å‹ XSS</h1>
      <p class="subtitle">Reflected XSS Attack</p>
    </header>

    <section>
      <h2>ğŸ“– åŸç†è¯´æ˜</h2>
      <p>åå°„å‹ XSS çš„ç‰¹ç‚¹æ˜¯ï¼šæ¶æ„è„šæœ¬æ¥è‡ªå½“å‰ HTTP è¯·æ±‚ã€‚</p>
      <p style="margin-top: 0.5rem;">æ”»å‡»æµç¨‹ï¼š</p>
      <ol style="margin: 1rem 0 0 1.5rem;">
        <li>æ”»å‡»è€…æ„é€ åŒ…å«æ¶æ„è„šæœ¬çš„ URL</li>
        <li>è¯±å¯¼ç”¨æˆ·ç‚¹å‡»è¯¥é“¾æ¥</li>
        <li>æœåŠ¡å™¨å°†æ¶æ„è„šæœ¬"åå°„"å›é¡µé¢</li>
        <li>æµè§ˆå™¨æ‰§è¡Œæ¶æ„è„šæœ¬</li>
      </ol>
    </section>

    <section>
      <h2>ğŸ§ª æ¼æ´æ¼”ç¤º</h2>
      
      <div class="toggle-group">
        <label>
          <input type="radio" name="mode" value="unsafe" checked> 
          âŒ æœ‰æ¼æ´ç‰ˆæœ¬
        </label>
        <label>
          <input type="radio" name="mode" value="safe"> 
          âœ… å®‰å…¨ç‰ˆæœ¬
        </label>
      </div>

      <div style="margin: 1rem 0;">
        <input type="text" id="searchInput" placeholder="è¾“å…¥æœç´¢å†…å®¹...">
        <button class="btn" onclick="doSearch()" style="margin-top: 0.5rem;">æœç´¢</button>
      </div>

      <div class="warning-box">
        <strong>ğŸ’¡ å°è¯•ä»¥ä¸‹ Payloadï¼š</strong>
        <p style="margin-top: 0.5rem;">
          <code>&lt;script&gt;alert('XSS')&lt;/script&gt;</code>
        </p>
        <p style="margin-top: 0.5rem;">
          <code>&lt;img src=x onerror="alert('XSS')"&gt;</code>
        </p>
        <p style="margin-top: 0.5rem;">
          <code>&lt;svg onload="alert('XSS')"&gt;</code>
        </p>
      </div>

      <div class="info-box">
        <strong>ğŸ”— æ”»å‡»è€…ä¼šæ„é€ è¿™æ ·çš„é“¾æ¥ï¼š</strong>
        <p style="margin-top: 0.5rem; word-break: break-all;">
          <code id="attackUrl">http://localhost:4000/api/search/unsafe?q=&lt;script&gt;alert('XSS')&lt;/script&gt;</code>
        </p>
        <button class="btn btn-secondary" onclick="copyUrl()" style="margin-top: 0.5rem;">å¤åˆ¶é“¾æ¥</button>
      </div>
    </section>

    <section>
      <h2>ğŸ”¬ æ¼æ´ä»£ç åˆ†æ</h2>
      <p>æœ‰æ¼æ´çš„åç«¯ä»£ç ï¼š</p>
      <pre><code>// âŒ ç›´æ¥æ‹¼æ¥ç”¨æˆ·è¾“å…¥
res.send(`
  &lt;h1&gt;æœç´¢ç»“æœ&lt;/h1&gt;
  &lt;div&gt;ä½ æœç´¢çš„æ˜¯ï¼š${q}&lt;/div&gt;
`)
// æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼</code></pre>

      <p style="margin-top: 1rem;">å®‰å…¨çš„åç«¯ä»£ç ï¼š</p>
      <pre><code>// âœ… HTML å®ä½“è½¬ä¹‰
const safeQ = escapeHtml(q)
res.send(`
  &lt;h1&gt;æœç´¢ç»“æœ&lt;/h1&gt;
  &lt;div&gt;ä½ æœç´¢çš„æ˜¯ï¼š${safeQ}&lt;/div&gt;
`)

function escapeHtml(str) {
  return str
    .replace(/&/g, '&amp;amp;')
    .replace(/&lt;/g, '&amp;lt;')
    .replace(/&gt;/g, '&amp;gt;')
}</code></pre>
    </section>

    <section>
      <h2>ğŸ›¡ï¸ é˜²å¾¡è¦ç‚¹</h2>
      <ul style="margin-left: 1.5rem;">
        <li>å¯¹æ‰€æœ‰ç”¨æˆ·è¾“å…¥è¿›è¡Œ HTML å®ä½“ç¼–ç </li>
        <li>ä½¿ç”¨æ¨¡æ¿å¼•æ“çš„è‡ªåŠ¨è½¬ä¹‰åŠŸèƒ½</li>
        <li>è®¾ç½® CSP å¤´é™åˆ¶è„šæœ¬æ‰§è¡Œ</li>
      </ul>
    </section>
  </div>

  <script>
    function doSearch() {
      const input = document.getElementById('searchInput').value
      const mode = document.querySelector('input[name="mode"]:checked').value
      const url = `/api/search/${mode}?q=${encodeURIComponent(input)}`
      window.open(url, '_blank')
    }

    function copyUrl() {
      const url = document.getElementById('attackUrl').textContent
      navigator.clipboard.writeText(url)
      alert('é“¾æ¥å·²å¤åˆ¶ï¼')
    }

    // æ›´æ–°æ”»å‡»é“¾æ¥
    document.getElementById('searchInput').addEventListener('input', function(e) {
      const mode = document.querySelector('input[name="mode"]:checked').value
      document.getElementById('attackUrl').textContent = 
        `http://localhost:4000/api/search/${mode}?q=${encodeURIComponent(e.target.value)}`
    })
  </script>
</body>
</html>
